{
	"appsUsed":[
		"storage_by_unifyapps"
	],
	"createdTime":1738309677710,
	"deleted":false,
	"deploymentState":{
		"deployedAt":1760296215068,
		"deployedBy":-1,
		"deployedDefinitionId":"68ebfd16672fcc41fb70f135",
		"status":"DEPLOYED",
		"version":66,
		"workflowVersion":96
	},
	"edges":[
		{
			"fromNodeId":"le3y3",
			"priority":0,
			"skip":false,
			"toNodeId":"53LAF",
			"type":"next"
		},
		{
			"fromNodeId":"53LAF",
			"priority":0,
			"skip":false,
			"toNodeId":"n_Xlnn5",
			"type":"next"
		},
		{
			"fromNodeId":"n_Xlnn5",
			"priority":0,
			"skip":false,
			"toNodeId":"do2nR",
			"type":"next"
		},
		{
			"fromNodeId":"do2nR",
			"priority":0,
			"skip":false,
			"toNodeId":"_NGFnl",
			"type":"next"
		},
		{
			"fromNodeId":"_NGFnl",
			"priority":0,
			"skip":false,
			"toNodeId":"n_TuMfu",
			"type":"next"
		},
		{
			"fromNodeId":"n_TuMfu",
			"priority":0,
			"skip":false,
			"toNodeId":"_LDYaq",
			"type":"next"
		},
		{
			"fromNodeId":"_LDYaq",
			"priority":0,
			"skip":false,
			"toNodeId":"_KwFz2",
			"type":"next"
		},
		{
			"fromNodeId":"_KwFz2",
			"name":"yes",
			"priority":0,
			"skip":false,
			"toNodeId":"_ZeXKb",
			"type":"if"
		},
		{
			"fromNodeId":"_ZeXKb",
			"priority":0,
			"skip":false,
			"toNodeId":"_UlrMo",
			"type":"loop"
		},
		{
			"fromNodeId":"_UlrMo",
			"priority":0,
			"skip":false,
			"toNodeId":"_94gvN",
			"type":"next"
		},
		{
			"fromNodeId":"_94gvN",
			"priority":0,
			"skip":false,
			"toNodeId":"_UyrXt",
			"type":"next"
		},
		{
			"fromNodeId":"_UyrXt",
			"name":"yes",
			"priority":0,
			"skip":false,
			"toNodeId":"_0dCO5",
			"type":"if"
		},
		{
			"fromNodeId":"_0dCO5",
			"priority":0,
			"skip":false,
			"toNodeId":"_MLDQc",
			"type":"next"
		},
		{
			"fromNodeId":"_MLDQc",
			"name":"yes",
			"priority":0,
			"skip":false,
			"toNodeId":"_XNZhr",
			"type":"if"
		},
		{
			"fromNodeId":"_XNZhr",
			"priority":0,
			"skip":false,
			"toNodeId":"_NBFmP",
			"type":"next"
		},
		{
			"fromNodeId":"_MLDQc",
			"name":"no",
			"priority":0,
			"skip":false,
			"toNodeId":"_NBFmP",
			"type":"next"
		},
		{
			"fromNodeId":"_NBFmP",
			"priority":0,
			"skip":false,
			"toNodeId":"_keZUp",
			"type":"next"
		},
		{
			"fromNodeId":"_UyrXt",
			"name":"no",
			"priority":0,
			"skip":false,
			"toNodeId":"_keZUp",
			"type":"next"
		},
		{
			"fromNodeId":"_keZUp",
			"priority":0,
			"skip":false,
			"toNodeId":"n_Auu7o",
			"type":"next"
		},
		{
			"fromNodeId":"n_Auu7o",
			"priority":0,
			"skip":false,
			"toNodeId":"_XvvRo",
			"type":"next"
		},
		{
			"fromNodeId":"_XvvRo",
			"name":"success",
			"priority":0,
			"skip":false,
			"toNodeId":"n_LCpO5",
			"type":"next"
		},
		{
			"fromNodeId":"n_LCpO5",
			"priority":0,
			"skip":false,
			"toNodeId":"n_4np6g",
			"type":"next"
		},
		{
			"fromNodeId":"_XvvRo",
			"name":"error",
			"priority":0,
			"skip":false,
			"toNodeId":"_cyNOJ",
			"type":"error"
		},
		{
			"fromNodeId":"_cyNOJ",
			"priority":0,
			"skip":false,
			"toNodeId":"n_yZT3b",
			"type":"next"
		},
		{
			"fromNodeId":"n_4np6g",
			"priority":0,
			"skip":false,
			"toNodeId":"_yhHvW",
			"type":"next"
		},
		{
			"fromNodeId":"n_yZT3b",
			"priority":0,
			"skip":false,
			"toNodeId":"_yhHvW",
			"type":"next"
		},
		{
			"fromNodeId":"_yhHvW",
			"priority":0,
			"skip":false,
			"toNodeId":"_F80jl",
			"type":"next"
		},
		{
			"fromNodeId":"_F80jl",
			"name":"loopback",
			"priority":0,
			"skip":false,
			"toNodeId":"_ZeXKb",
			"type":"next"
		},
		{
			"fromNodeId":"_ZeXKb",
			"priority":0,
			"skip":false,
			"toNodeId":"GJSUp",
			"type":"next"
		},
		{
			"fromNodeId":"oZ3KL",
			"priority":0,
			"skip":false,
			"toNodeId":"GJSUp",
			"type":"next"
		},
		{
			"fromNodeId":"_KwFz2",
			"name":"no",
			"priority":0,
			"skip":false,
			"toNodeId":"GJSUp",
			"type":"next"
		},
		{
			"fromNodeId":"GJSUp",
			"priority":0,
			"skip":false,
			"toNodeId":"7AvkW",
			"type":"loop"
		},
		{
			"fromNodeId":"7AvkW",
			"priority":0,
			"skip":false,
			"toNodeId":"n_OgZ1z",
			"type":"next"
		},
		{
			"fromNodeId":"n_OgZ1z",
			"name":"yes",
			"priority":0,
			"skip":false,
			"toNodeId":"_waB5G",
			"type":"if"
		},
		{
			"fromNodeId":"_waB5G",
			"priority":0,
			"skip":false,
			"toNodeId":"lr0UB",
			"type":"next"
		},
		{
			"fromNodeId":"n_OgZ1z",
			"name":"no",
			"priority":0,
			"skip":false,
			"toNodeId":"lr0UB",
			"type":"next"
		},
		{
			"fromNodeId":"lr0UB",
			"priority":0,
			"skip":false,
			"toNodeId":"nLE0z",
			"type":"next"
		},
		{
			"fromNodeId":"nLE0z",
			"name":"yes",
			"priority":0,
			"skip":false,
			"toNodeId":"_dGN2s",
			"type":"if"
		},
		{
			"fromNodeId":"_dGN2s",
			"priority":0,
			"skip":false,
			"toNodeId":"n_eC5KA",
			"type":"next"
		},
		{
			"fromNodeId":"n_eC5KA",
			"name":"yes",
			"priority":0,
			"skip":false,
			"toNodeId":"_NzqcM",
			"type":"if"
		},
		{
			"fromNodeId":"_NzqcM",
			"priority":0,
			"skip":false,
			"toNodeId":"9JXJ6",
			"type":"next"
		},
		{
			"fromNodeId":"n_eC5KA",
			"name":"no",
			"priority":0,
			"skip":false,
			"toNodeId":"9JXJ6",
			"type":"next"
		},
		{
			"fromNodeId":"9JXJ6",
			"priority":0,
			"skip":false,
			"toNodeId":"PXUiF",
			"type":"next"
		},
		{
			"fromNodeId":"nLE0z",
			"name":"no",
			"priority":0,
			"skip":false,
			"toNodeId":"PXUiF",
			"type":"next"
		},
		{
			"fromNodeId":"PXUiF",
			"priority":0,
			"skip":false,
			"toNodeId":"_DLXc9",
			"type":"next"
		},
		{
			"fromNodeId":"_DLXc9",
			"priority":0,
			"skip":false,
			"toNodeId":"Ymh6A",
			"type":"next"
		},
		{
			"fromNodeId":"Ymh6A",
			"name":"success",
			"priority":0,
			"skip":false,
			"toNodeId":"_IMnXd",
			"type":"next"
		},
		{
			"fromNodeId":"Ymh6A",
			"name":"error",
			"priority":0,
			"skip":false,
			"toNodeId":"_KLlkQ",
			"type":"error"
		},
		{
			"fromNodeId":"_KLlkQ",
			"priority":0,
			"skip":false,
			"toNodeId":"_LkfRx",
			"type":"next"
		},
		{
			"fromNodeId":"_IMnXd",
			"priority":0,
			"skip":false,
			"toNodeId":"fYHvJ",
			"type":"next"
		},
		{
			"fromNodeId":"_LkfRx",
			"priority":0,
			"skip":false,
			"toNodeId":"fYHvJ",
			"type":"next"
		},
		{
			"fromNodeId":"fYHvJ",
			"priority":0,
			"skip":false,
			"toNodeId":"oZ3KL",
			"type":"next"
		},
		{
			"fromNodeId":"GJSUp",
			"priority":0,
			"skip":false,
			"toNodeId":"HUjmx",
			"type":"next"
		},
		{
			"fromNodeId":"HUjmx",
			"priority":0,
			"skip":false,
			"toNodeId":"XYHEW",
			"type":"next"
		}
	],
	"grants":{
		"configs":[
			{
				"permissions":[
					"VIEW_RUNS",
					"V"
				],
				"principalType":"GLOBAL"
			}
		]
	},
	"id":"679b7fdad2256d4d7f3277fe",
	"lastModifiedBy":309,
	"lcName":"fetch chunks given filter and embedding models",
	"modifiedTime":1761424590604,
	"name":"Fetch Chunks Given Filter and Embedding Models",
	"nodes":[
		{
			"context":{
				"appName":"callables",
				"resourceVersion":16,
				"resourceName":"callables_from_automation"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"qoogX-1",
			"id":"le3y3",
			"index":1,
			"inputs":{
				"result":{
					"type":"object",
					"additionalProperties":false,
					"properties":{
						"relevantContent":{
							"type":"array",
							"items":{
								"type":"object",
								"properties":{
									"score":{
										"type":"number",
										"title":"score"
									},
									"document":{
										"type":"object",
										"title":"document"
									}
								},
								"additionalProperties":false,
								"required":[]
							},
							"title":"relevantContent"
						}
					}
				},
				"setup":{
					"type":"object",
					"additionalProperties":false,
					"required":[],
					"properties":{
						"userQuery":{
							"type":"string",
							"title":"User Query"
						},
						"sharedWithIds":{
							"type":"array",
							"items":{
								"type":"string"
							},
							"title":"Shared With Ids"
						},
						"includeCustomMetadataFilter":{
							"type":"boolean",
							"title":"Include Custom Metadata Filter"
						},
						"knowledges":{
							"type":"array",
							"items":{
								"type":"object",
								"properties":{},
								"additionalProperties":false,
								"required":[]
							},
							"title":"Knowledges"
						},
						"filter":{
							"type":"object",
							"properties":{},
							"additionalProperties":false,
							"title":"Filter"
						},
						"knowledgeSets":{
							"type":"array",
							"items":{
								"type":"object",
								"properties":{},
								"additionalProperties":false
							},
							"title":"Knowledge Sets"
						},
						"archivedRawDataIds":{
							"type":"array",
							"items":{
								"type":"string"
							},
							"title":"Archived Raw Data Ids"
						},
						"caseId":{
							"type":"string",
							"title":"Case Id"
						}
					}
				}
			},
			"skip":false,
			"subTitle":"Callable",
			"title":"Trigger via automation",
			"trigger":{
				"type":"CALLABLE"
			},
			"type":"START"
		},
		{
			"context":{
				"appName":"variable_by_unifyapps",
				"resourceVersion":220,
				"resourceName":"variable_by_unifyapps_get_session_variables",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"qoogX-1",
			"id":"53LAF",
			"index":2,
			"inputs":{
				"variableSchema":{
					"type":"object",
					"additionalProperties":false,
					"required":[],
					"properties":{
						"ai_agent_use_deployed_entity":{
							"type":"boolean",
							"title":"Ai Agent Use Deployed Entity"
						},
						"ai_agent_deployed_version":{
							"type":"integer",
							"title":"Ai Agent Deployed Version"
						},
						"aiAgentId":{
							"type":"string",
							"title":"Ai Agent Id"
						},
						"caseId":{
							"type":"string",
							"title":"Case Id"
						},
						"messageId":{
							"type":"string",
							"title":"Message Id"
						}
					}
				}
			},
			"skip":false,
			"subTitle":"Variable by UnifyApps",
			"title":"Get Session Variables",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"storage_by_unifyapps",
				"resourceVersion":457,
				"resourceName":"storage_by_unifyapps_fetch_records",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"qoogX-1",
			"id":"n_Xlnn5",
			"index":3,
			"inputs":{
				"searchField":{
					"fields":[
						"properties_aiAgentId"
					],
					"expression":"GLOBAL"
				},
				"object_type":"e_ai_agent_settings",
				"includeRoleMappings":false,
				"includeCurrentUserPermissions":false,
				"translationsOption":"DEFAULT",
				"page":{
					"paginateBy":"OFFSET",
					"limit":20
				},
				"numberOfRecordsToFetch":"SINGLE",
				"readThroughSessionVariables":false,
				"includeTotalCount":false
			},
			"options":{
				"businessHoursConfig":{
					"enabled":false,
					"waitForNextWindow":false
				},
				"cacheConfig":{
					"enabled":false,
					"timeToLive":"3600",
					"usagePolicy":"ALWAYS"
				},
				"circuitBreakerConfig":{
					"enabled":false,
					"slidingWindowType":"COUNT_BASED"
				},
				"disableLogging":false,
				"enabledForReExecution":false,
				"hookConfig":{
					"enabled":false,
					"postHooks":[
						
					],
					"preHooks":[
						
					]
				},
				"logConfig":{
					"enabled":false,
					"logPolicies":[
						
					]
				},
				"rateLimitConfig":{
					"enabled":false,
					"unit":"MINUTES",
					"waitForNextWindow":false
				},
				"retryConfig":{
					"backOffFactor":null,
					"captureRetries":false,
					"enabled":false
				},
				"stepError":"STOP",
				"telemetryConfig":{
					"enableTelemetry":false,
					"metricConfigs":[
						
					]
				}
			},
			"skip":false,
			"subTitle":"Storage by UnifyApps",
			"title":"Fetch records",
			"type":"ACTION"
		},
		{
			"additional":{
				"visibleOptionalFields":[
					"root.parameters.knowledges.items"
				]
			},
			"context":{
				"appName":"code_by_unifyapps",
				"resourceVersion":16,
				"resourceName":"code_by_unifyapps_groovy",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"qoogX-1",
			"id":"do2nR",
			"index":4,
			"inputs":{
				"output":{
					"type":"object",
					"additionalProperties":false,
					"properties":{
						"embeddingVsKnowledgeFilter":{
							"type":"array",
							"items":{
								"type":"object",
								"properties":{
									"embeddingModel":{
										"type":"string",
										"title":"embeddingModel"
									},
									"knowledgeFilter":{
										"type":"object",
										"properties":{},
										"additionalProperties":false,
										"title":"Knowledge Filter"
									},
									"vectorStore":{
										"type":"string",
										"title":"Vector Store"
									},
									"vectorStoreConnectionId":{
										"type":"string",
										"title":"Vector Store Connection Id"
									}
								},
								"additionalProperties":false,
								"required":[]
							},
							"title":"embeddingVsKnowledgeFilter"
						}
					}
				},
				"input":{
					"type":"object",
					"additionalProperties":false,
					"required":[],
					"properties":{
						"knowledges":{
							"type":"array",
							"items":{
								"type":"object",
								"properties":{},
								"additionalProperties":false
							},
							"title":"Knowledges"
						},
						"globalEmbeddingModel":{
							"type":"string",
							"title":"Global Embedding Model"
						}
					}
				},
				"code":"// def finalMap = [:]\n// def finalFilter = []\n// def defaultModel = binding.hasVariable('globalEmbeddingModel')?globalEmbeddingModel:\"DEFAULT\"\n\n// if (!binding.hasVariable(\"knowledges\")){\n//   return [\"embeddingVsKnowledgeFilter\": []]\n// }\n\n// for(knowledge in knowledges) {\n//   def embeddingModel = knowledge.properties.additionalDetails?.embeddingModel\n//   if(embeddingModel == null) {\n//     embeddingModel = defaultModel\n//   }\n//   def currentKnowledges = finalMap.get(embeddingModel)\n//   if(currentKnowledges == null) {\n//     currentKnowledges = []\n//   }\n//    currentKnowledges.add(knowledge.id)\n//    finalMap.put(embeddingModel, currentKnowledges)\n   \n// }\n// for(entry in finalMap) {\n//   def knowledgeIds = entry.getValue();\n//   def knowledgeIdsFilter = [\n//         field: 'id',\n//         op: 'IN',\n//         values: knowledgeIds\n//     ]   \n//   finalFilter.add([\"embeddingModel\": entry.getKey(), \"knowledgeFilter\": knowledgeIdsFilter])\n// }\n// return [\"embeddingVsKnowledgeFilter\": finalFilter]\n\ndef finalMap = [:]\ndef finalFilter = []\n\ndef defaultModel = binding.hasVariable('globalEmbeddingModel') ? globalEmbeddingModel : \"DEFAULT\"\n\nif (!binding.hasVariable(\"knowledges\")) {\n    return [\"result\": [\"embeddingVsKnowledgeFilter\": []]]\n}\n\nknowledges.each { knowledge ->\n    def id = knowledge.id\n    def additionalDetails = knowledge.properties?.additionalDetails ?: [:]\n\n    def embeddingModel = additionalDetails.embeddingModel ?: defaultModel\n    //temporary check for ui passing incorrect value, can be removed once resolved\n    if(embeddingModel==\"e_66b2808745f17a17c0e7c271\")\n    embeddingModel = defaultModel\n    def vectorStore = additionalDetails.vectorStore ?: \"\"\n    def vectorStoreId = additionalDetails.vectorStoreConnectionId ?: \"\"\n\n    // Use + instead of $ or GString\n    def compositeKey = embeddingModel + \"||\" + vectorStore + \"||\" + vectorStoreId\n\n    def currentKnowledgeList = finalMap.get(compositeKey)\n    if (currentKnowledgeList == null) {\n        currentKnowledgeList = []\n    }\n    currentKnowledgeList.add(id)\n    finalMap[compositeKey] = currentKnowledgeList\n}\n\nfinalMap.each { key, ids ->\n    def parts = key.split(\"\\\\|\\\\|\", -1)\n    def embeddingModel = parts[0]\n    def vectorStore = parts[1]\n    def vectorStoreId = parts[2]\n\n    def knowledgeFilter = [\n        field : 'id',\n        op    : 'IN',\n        values: ids\n    ]\n\n    def resultItem = [\n        embeddingModel : embeddingModel,\n        knowledgeFilter: knowledgeFilter\n    ]\n\n    if (vectorStore) {\n        resultItem.vectorStore = vectorStore\n    }\n\n    if (vectorStoreId) {\n        resultItem.vectorStoreConnectionId = vectorStoreId\n    }\n\n    finalFilter.add(resultItem)\n}\n\nreturn [\"embeddingVsKnowledgeFilter\": finalFilter]\n",
				"compile_static":false,
				"captureStdOutput":false,
				"parameters":{
					"globalEmbeddingModel":"{{ n_Xlnn5.outputs.properties.indexingSettings.embeddingModel }}",
					"knowledges":{
						"source":"{{ le3y3.outputs.knowledges }}",
						"ua:type":"mappedArray",
						"items":"{{ le3y3.outputs.knowledges[0] }}"
					}
				}
			},
			"skip":false,
			"subTitle":"filters",
			"title":"Execute Groovy code",
			"type":"ACTION"
		},
		{
			"additional":{
				"visibleOptionalFields":[
					"root.parameters.knowledgeSet.items"
				]
			},
			"context":{
				"appName":"code_by_unifyapps",
				"resourceVersion":16,
				"resourceName":"code_by_unifyapps_groovy",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"qoogX-1",
			"id":"_NGFnl",
			"index":5,
			"inputs":{
				"output":{
					"type":"object",
					"additionalProperties":false,
					"properties":{
						"embeddingVsKnowledgeFilter":{
							"type":"array",
							"items":{
								"type":"object",
								"properties":{
									"embeddingModel":{
										"type":"string",
										"title":"embeddingModel"
									},
									"knowledgeFilter":{
										"type":"object",
										"properties":{},
										"additionalProperties":false,
										"title":"Knowledge Filter"
									},
									"vectorStore":{
										"type":"string",
										"title":"Vector Store"
									},
									"vectorStoreConnectionId":{
										"type":"string",
										"title":"Vector Store Connection Id"
									}
								},
								"additionalProperties":false,
								"required":[]
							},
							"title":"embeddingVsKnowledgeFilter"
						}
					}
				},
				"input":{
					"type":"object",
					"additionalProperties":false,
					"required":[],
					"properties":{
						"globalEmbeddingModel":{
							"type":"string",
							"title":"Global Embedding Model"
						},
						"knowledgeSet":{
							"type":"array",
							"items":{
								"type":"object",
								"properties":{},
								"additionalProperties":false
							},
							"title":"Knowledge Set"
						}
					}
				},
				"code":"def finalMap = [:]\ndef finalFilter = []\n\ndef defaultModel = binding.hasVariable('globalEmbeddingModel') ? globalEmbeddingModel : \"DEFAULT\"\n\nif (!binding.hasVariable(\"knowledgeSet\")) {\n    return [\"embeddingVsKnowledgeFilter\": []]\n}\n\nknowledgeSet.each { knowledge ->\n    def id = knowledge.id\n\n    def embeddingModel = knowledge.properties?.indexingSettings?.embeddingModel ?: defaultModel\n\n    if (embeddingModel == \"e_66b2808745f17a17c0e7c271\") {\n        embeddingModel = defaultModel\n    }\n    def vectorStore = knowledge.properties?.indexingSettings?.vectorStore ?: \"\"\n    def vectorStoreId = knowledge.properties?.indexingSettings?.vectorStoreConnectionId ?: \"\"\n\n    def compositeKey = embeddingModel + \"||\" + vectorStore + \"||\" + vectorStoreId\n\n    def currentKnowledgeList = finalMap.get(compositeKey)\n    if (currentKnowledgeList == null) {\n        currentKnowledgeList = []\n    }\n\n    currentKnowledgeList.add(id)\n\n    finalMap[compositeKey] = currentKnowledgeList\n}\n\nfinalMap.each { key, ids ->\n\n    def parts = key.split(\"\\\\|\\\\|\", -1)\n    def embeddingModel = parts[0]\n    def vectorStore = parts[1]\n    def vectorStoreId = parts[2]\n\n    def knowledgeFilter = [\n        field : 'id',\n        op    : 'IN',\n        values: ids\n    ]\n\n    def resultItem = [\n        embeddingModel : embeddingModel,\n        knowledgeFilter: knowledgeFilter\n    ]\n\n    if (vectorStore) {\n        resultItem.vectorStore = vectorStore\n    }\n\n    if (vectorStoreId) {\n        resultItem.vectorStoreConnectionId = vectorStoreId\n    }\n\n    finalFilter.add(resultItem)\n}\n\nreturn [\"embeddingVsKnowledgeFilter\": finalFilter]\n",
				"compile_static":false,
				"captureStdOutput":false,
				"parameters":{
					"globalEmbeddingModel":"{{ n_Xlnn5.outputs.properties.indexingSettings.embeddingModel }}",
					"knowledgeSet":{
						"ua:type":"mappedArray",
						"source":"{{ le3y3.outputs.knowledgeSets }}",
						"items":"{{ le3y3.outputs.knowledgeSets[0] }}"
					}
				}
			},
			"skip":false,
			"subTitle":"KnowledgeSetFilters",
			"title":"Execute Groovy code",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"variable_by_unifyapps",
				"resourceVersion":13,
				"resourceName":"variable_by_unifyapps_create_list",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"qoogX-1",
			"id":"n_TuMfu",
			"index":6,
			"inputSchema":{
				"type":"SCHEMA_AND_LAYOUT",
				"dynamic":false,
				"layout":{
					"createList":{
						"ui:title":"",
						"ua:type":{
							"ui:widget":"hidden"
						},
						"items":{
							"ui:title":"Initial list items",
							"ui:description":"Set the initial values of the list (defaults to empty)"
						},
						"ui:order":[
							"*",
							"items"
						]
					},
					"ua:title":{
						"ui:widget":"hidden"
					},
					"ua:list_type":{
						"ui:widget":"hidden"
					}
				},
				"schema":{
					"allOf":[
						{
							"if":{
								"properties":{
									"ua:list_type":{
										"const":"OBJECT"
									}
								}
							},
							"then":{
								"properties":{
									"createList":{
										"type":"object",
										"properties":{
											"items":{
												"type":"object",
												"properties":{}
											}
										}
									}
								}
							}
						},
						{
							"if":{
								"properties":{
									"ua:list_type":{
										"const":"STRING"
									}
								}
							},
							"then":{
								"properties":{
									"createList":{
										"type":"object",
										"properties":{
											"source":{
												"type":"string",
												"format":"ua:source",
												"title":"List of String"
											},
											"items":{
												"type":"string"
											}
										}
									}
								}
							}
						},
						{
							"if":{
								"properties":{
									"ua:list_type":{
										"const":"INTEGER"
									}
								}
							},
							"then":{
								"properties":{
									"createList":{
										"type":"object",
										"properties":{
											"source":{
												"type":"string",
												"format":"ua:source",
												"title":"List of Integers"
											},
											"items":{
												"type":"integer"
											}
										}
									}
								}
							}
						},
						{
							"if":{
								"properties":{
									"ua:list_type":{
										"const":"NUMBER"
									}
								}
							},
							"then":{
								"properties":{
									"createList":{
										"type":"object",
										"properties":{
											"source":{
												"type":"string",
												"format":"ua:source",
												"title":"List of Numbers"
											},
											"items":{
												"type":"number"
											}
										}
									}
								}
							}
						},
						{
							"if":{
								"properties":{
									"ua:list_type":{
										"const":"BOOLEAN"
									}
								}
							},
							"then":{
								"properties":{
									"createList":{
										"type":"object",
										"properties":{
											"source":{
												"type":"string",
												"format":"ua:source",
												"title":"List of Booleans"
											},
											"items":{
												"type":"boolean"
											}
										}
									}
								}
							}
						}
					],
					"format":"ua:list",
					"type":"object",
					"properties":{
						"ua:title":{
							"type":"string"
						},
						"ua:list_type":{
							"type":"string",
							"title":"List Type",
							"oneOf":[
								{
									"const":"OBJECT",
									"title":"Object"
								},
								{
									"const":"STRING",
									"title":"String"
								},
								{
									"const":"NUMBER",
									"title":"Number"
								},
								{
									"const":"INTEGER",
									"title":"Integer"
								},
								{
									"const":"BOOLEAN",
									"title":"Boolean"
								}
							],
							"default":"OBJECT"
						},
						"createList":{
							"type":"object",
							"properties":{
								"ua:type":{
									"type":"string",
									"default":"mappedArray"
								},
								"source":{
									"type":"string",
									"format":"ua:source",
									"title":"List Item Source"
								},
								"items":{
									"additionalProperties":false,
									"type":[
										"object",
										"string",
										"number",
										"boolean",
										"integer"
									],
									"properties":{}
								}
							}
						}
					}
				}
			},
			"inputs":{
				"createList":{
					"ua:type":"mappedArray",
					"source":"{{ le3y3.outputs.knowledgeSets }}",
					"items":"{{ le3y3.outputs.knowledgeSets[0].id }}"
				},
				"ua:title":"knowledgeSetIds",
				"ua:list_type":"STRING"
			},
			"outputSchema":{
				"dynamic":false,
				"schema":{
					"type":"object",
					"properties":{
						"items":{
							"type":"array",
							"title":"knowledgeSetIds",
							"disableActions":true,
							"items":{
								"type":"string"
							}
						}
					}
				}
			},
			"skip":false,
			"subTitle":"knowledgeSetIds",
			"title":"Create list",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"variable_by_unifyapps",
				"resourceVersion":11,
				"resourceName":"variable_by_unifyapps_create_list",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"qoogX-1",
			"id":"_LDYaq",
			"index":7,
			"inputSchema":{
				"type":"SCHEMA_AND_LAYOUT",
				"dynamic":false,
				"layout":{
					"createList":{
						"ui:title":"",
						"ua:type":{
							"ui:widget":"hidden"
						},
						"items":{
							"ui:title":"Initial list items",
							"ui:description":"Set the initial values of the list (defaults to empty)"
						},
						"ui:order":[
							"*",
							"items"
						]
					},
					"ua:title":{
						"ui:widget":"hidden"
					},
					"ua:list_type":{
						"ui:widget":"hidden"
					}
				},
				"schema":{
					"allOf":[
						{
							"if":{
								"properties":{
									"ua:list_type":{
										"const":"OBJECT"
									}
								}
							},
							"then":{
								"properties":{
									"createList":{
										"type":"object",
										"properties":{
											"items":{
												"type":"object",
												"properties":{}
											}
										}
									}
								}
							}
						},
						{
							"if":{
								"properties":{
									"ua:list_type":{
										"const":"STRING"
									}
								}
							},
							"then":{
								"properties":{
									"createList":{
										"type":"object",
										"properties":{
											"source":{
												"type":"string",
												"format":"ua:source",
												"title":"List of String"
											},
											"items":{
												"type":"string"
											}
										}
									}
								}
							}
						},
						{
							"if":{
								"properties":{
									"ua:list_type":{
										"const":"INTEGER"
									}
								}
							},
							"then":{
								"properties":{
									"createList":{
										"type":"object",
										"properties":{
											"source":{
												"type":"string",
												"format":"ua:source",
												"title":"List of Integers"
											},
											"items":{
												"type":"integer"
											}
										}
									}
								}
							}
						},
						{
							"if":{
								"properties":{
									"ua:list_type":{
										"const":"NUMBER"
									}
								}
							},
							"then":{
								"properties":{
									"createList":{
										"type":"object",
										"properties":{
											"source":{
												"type":"string",
												"format":"ua:source",
												"title":"List of Numbers"
											},
											"items":{
												"type":"number"
											}
										}
									}
								}
							}
						},
						{
							"if":{
								"properties":{
									"ua:list_type":{
										"const":"BOOLEAN"
									}
								}
							},
							"then":{
								"properties":{
									"createList":{
										"type":"object",
										"properties":{
											"source":{
												"type":"string",
												"format":"ua:source",
												"title":"List of Booleans"
											},
											"items":{
												"type":"boolean"
											}
										}
									}
								}
							}
						}
					],
					"format":"ua:list",
					"type":"object",
					"properties":{
						"ua:title":{
							"type":"string"
						},
						"ua:list_type":{
							"type":"string",
							"title":"List Type",
							"oneOf":[
								{
									"const":"OBJECT",
									"title":"Object"
								},
								{
									"const":"STRING",
									"title":"String"
								},
								{
									"const":"NUMBER",
									"title":"Number"
								},
								{
									"const":"INTEGER",
									"title":"Integer"
								},
								{
									"const":"BOOLEAN",
									"title":"Boolean"
								}
							],
							"default":"OBJECT"
						},
						"createList":{
							"type":"object",
							"properties":{
								"ua:type":{
									"type":"string",
									"default":"mappedArray"
								},
								"source":{
									"type":"string",
									"format":"ua:source",
									"title":"List Item Source"
								},
								"items":{
									"type":"object",
									"properties":{
										"score":{
											"type":"number",
											"title":"score"
										},
										"document":{
											"type":"object",
											"title":"document"
										}
									},
									"additionalProperties":false,
									"required":[]
								}
							}
						}
					}
				}
			},
			"inputs":{
				"createList":{
					"ua:type":"mappedArray"
				},
				"ua:title":"relevantContent",
				"ua:list_type":"OBJECT"
			},
			"outputSchema":{
				"dynamic":false,
				"schema":{
					"type":"object",
					"properties":{
						"items":{
							"type":"array",
							"title":"relevantContent",
							"disableActions":true,
							"items":{
								"type":"object",
								"properties":{
									"score":{
										"type":"number",
										"title":"score"
									},
									"document":{
										"type":"object",
										"title":"document"
									}
								},
								"required":[]
							}
						}
					}
				}
			},
			"skip":false,
			"subTitle":"relevant chunks",
			"title":"Create list",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"if_else",
				"resourceVersion":13,
				"resourceName":"if_else_condition",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"qoogX-1",
			"id":"_KwFz2",
			"index":8,
			"inputs":{
				"filters":[
					{
						"property":"{{ le3y3.outputs.knowledgeSets }}",
						"filter":{
							"operator":"EXISTS"
						}
					}
				],
				"operator":"AND"
			},
			"skip":false,
			"subTitle":"Condition",
			"title":"Condition",
			"type":"IF_ELSE"
		},
		{
			"context":{
				"appName":"loop",
				"resourceVersion":13,
				"resourceName":"loop_for_each",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_KwFz2@qoogX-1@y",
			"id":"_ZeXKb",
			"index":9,
			"inputs":{
				"repeatMode":"SINGLE",
				"listSource":"{{ _NGFnl.outputs.result.embeddingVsKnowledgeFilter }}",
				"captureIterations":false
			},
			"skip":false,
			"subTitle":"LoopOnKnowledgeSets",
			"title":"For each loop",
			"type":"LOOP"
		},
		{
			"context":{
				"appName":"storage_by_unifyapps",
				"resourceVersion":16,
				"resourceName":"storage_by_unifyapps_fetch_records",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_ZeXKb@_KwFz2@qoogX-1@y@l",
			"id":"_UlrMo",
			"index":10,
			"inputs":{
				"triggerInputCondition":{
					"filters":[
						{
							"resolvedFilter":{
								"filter":"{{ _ZeXKb.outputs.item.knowledgeFilter }}"
							}
						}
					],
					"operator":"AND"
				},
				"object_type":"knowledge_set",
				"includeRoleMappings":false,
				"includeCurrentUserPermissions":false,
				"translationsOption":"DEFAULT",
				"page":{
					"paginateBy":"OFFSET",
					"limit":2000
				},
				"numberOfRecordsToFetch":"MULTIPLE",
				"readThroughSessionVariables":false,
				"includeTotalCount":false,
				"fetchDeployedEntity":"{{ 53LAF.outputs.ai_agent_use_deployed_entity }}",
				"deployedEntityVersion":"{{ 53LAF.outputs.ai_agent_deployed_version }}"
			},
			"skip":false,
			"subTitle":"Fetch knowledgeSet",
			"title":"Fetch records",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"variable_by_unifyapps",
				"resourceVersion":17,
				"resourceName":"variable_by_unifyapps_create_variables",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_ZeXKb@_KwFz2@qoogX-1@y@l",
			"id":"_94gvN",
			"index":11,
			"inputSchema":{
				"type":"SCHEMA_AND_LAYOUT",
				"dynamic":false,
				"layout":{},
				"schema":{
					"additionalProperties":false,
					"type":"object",
					"properties":{
						"additionalFilter":{
							"type":"object",
							"properties":{},
							"additionalProperties":false,
							"title":"Additional Filter"
						}
					},
					"required":[]
				}
			},
			"inputs":{},
			"outputSchema":{
				"dynamic":false,
				"schema":{
					"additionalProperties":false,
					"type":"object",
					"properties":{
						"additionalFilter":{
							"type":"object",
							"properties":{},
							"additionalProperties":false,
							"title":"Additional Filter"
						},
						"_ua_variableDetails":{
							"items":{
								"properties":{
									"dataType":{
										"description":"Data type of the variable",
										"type":"string"
									},
									"description":{
										"description":"Description of the variable",
										"type":"string"
									},
									"name":{
										"description":"Name of the variable",
										"type":"string"
									}
								},
								"type":"object"
							},
							"title":"Variable Details",
							"type":"array"
						}
					},
					"required":[]
				}
			},
			"skip":false,
			"subTitle":"additionalFilter",
			"title":"Create variables",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"if_else",
				"resourceVersion":16,
				"resourceName":"if_else_condition",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_ZeXKb@_KwFz2@qoogX-1@y@l",
			"id":"_UyrXt",
			"index":12,
			"inputs":{
				"filters":[
					{
						"property":"{{ le3y3.outputs.includeCustomMetadataFilter }}",
						"filter":{
							"operator":"EQUAL",
							"value":"true"
						}
					}
				],
				"operator":"AND"
			},
			"skip":false,
			"subTitle":"custom metadata filter?",
			"title":"Condition",
			"type":"IF_ELSE"
		},
		{
			"context":{
				"appName":"callables",
				"resourceVersion":11,
				"resourceName":"callables_call_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_UyrXt@_ZeXKb@_KwFz2@qoogX-1@y@l@y",
			"id":"_0dCO5",
			"index":13,
			"inputs":{
				"automationId":"68beb1f8c6c0920a8698f516",
				"runtimeConnections":{},
				"synchronous":true,
				"version":"-1",
				"parameters":{
					"userQuery":"{{ le3y3.outputs.userQuery }}",
					"knowledgeSetIds":{
						"source":"{{ _UlrMo.outputs.objects }}",
						"ua:type":"mappedArray",
						"items":{
							"knowledgeSetId":"{{ _UlrMo.outputs.objects[0].id }}"
						}
					}
				}
			},
			"skip":false,
			"subTitle":"custom metadata filter",
			"title":"Call automation",
			"type":"CALL_WORKFLOW"
		},
		{
			"context":{
				"appName":"if_else",
				"resourceVersion":439,
				"resourceName":"if_else_condition",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_UyrXt@_ZeXKb@_KwFz2@qoogX-1@y@l@y",
			"id":"_MLDQc",
			"index":14,
			"inputs":{
				"filters":[
					{
						"property":"{{ _0dCO5.outputs.filter }}",
						"filter":{
							"operator":"MISSING"
						}
					}
				],
				"operator":"AND"
			},
			"skip":false,
			"subTitle":"Condition",
			"title":"Condition",
			"type":"IF_ELSE"
		},
		{
			"additional":{
				"visibleOptionalFields":[
					"root.result.relevantContent.source",
					"root.result.relevantContent.ua:type"
				]
			},
			"context":{
				"appName":"callables",
				"resourceVersion":16,
				"resourceName":"callables_return_to_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_MLDQc@_UyrXt@_ZeXKb@_KwFz2@qoogX-1@y@l@y@y",
			"id":"_XNZhr",
			"index":15,
			"inputs":{
				"result":{
					"relevantContent":{
						"source":"{{ _LDYaq.outputs.items }}",
						"ua:type":"mappedArray",
						"items":{
							"score":"{{ _LDYaq.outputs.items[0].score }}",
							"document":"{{ _LDYaq.outputs.items[0].document }}"
						}
					}
				}
			},
			"skip":false,
			"subTitle":"Callable",
			"title":"Respond to automation",
			"type":"STOP"
		},
		{
			"context":{
				"appName":"variable_by_unifyapps",
				"resourceVersion":16,
				"resourceName":"variable_by_unifyapps_update_variables",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_UyrXt@_ZeXKb@_KwFz2@qoogX-1@y@l@y",
			"id":"_NBFmP",
			"index":16,
			"inputs":{
				"variables":[
					{
						"source":"{{ _94gvN.outputs.additionalFilter }}",
						"value":"{{ _0dCO5.outputs.filter }}"
					}
				]
			},
			"skip":false,
			"subTitle":"Variable by UnifyApps",
			"title":"Update variables",
			"type":"ACTION"
		},
		{
			"additional":{
				"visibleOptionalFields":[
					"root.parameters.sharedWithIds.items",
					"root.parameters.knowledgeSet.items.id",
					"root.parameters.archivedRawDataIds.items"
				]
			},
			"context":{
				"appName":"code_by_unifyapps",
				"resourceVersion":52,
				"resourceName":"code_by_unifyapps_groovy",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_ZeXKb@_KwFz2@qoogX-1@y@l",
			"id":"_keZUp",
			"index":17,
			"inputs":{
				"output":{
					"type":"object",
					"additionalProperties":false,
					"properties":{
						"filter":{
							"type":"object",
							"title":"filter"
						}
					}
				},
				"input":{
					"type":"object",
					"additionalProperties":false,
					"required":[],
					"properties":{
						"sharedWithIds":{
							"type":"array",
							"items":{
								"type":"string"
							},
							"title":"sharedWithIds"
						},
						"filter":{
							"type":"object",
							"properties":{},
							"additionalProperties":false,
							"title":"Filter"
						},
						"knowledgeSet":{
							"type":"array",
							"items":{
								"type":"object",
								"properties":{
									"id":{
										"type":"string",
										"title":"Id"
									}
								},
								"additionalProperties":false,
								"required":[]
							},
							"title":"Knowledge Set"
						},
						"additionalFilter":{
							"type":"object",
							"properties":{},
							"additionalProperties":false,
							"title":"Additional Filter"
						},
						"archivedRawDataIds":{
							"type":"array",
							"items":{
								"type":"string"
							},
							"title":"Archived Raw Data Ids"
						}
					}
				},
				"code":"def combinedFilter = [\n    op: 'AND',\n    values: []\n]\n\n// SharedWithIds Filter\ndef sharedFilter = null\nif (binding.hasVariable('sharedWithIds')) {\n    sharedFilter = [\n        field: 'properties.sharedWithIds',\n        op: 'IN',\n        values: sharedWithIds\n    ]\n    combinedFilter['values'].add(sharedFilter)\n}\n\n// Knowledge Filter\ndef knowledgeSetFilter = null\nif (binding.hasVariable('knowledgeSet')) {\n    knowledgeSetFilter = [\n        op: 'OR',\n        values: knowledgeSet.collect { knowledgeItem ->\n            [\n                op: 'OR',\n                values: [\n                    [\n                        field: 'properties.knowledgeSetId',\n                        op: 'EQUAL',\n                        values: [knowledgeItem.id]\n                    ],\n                    [\n                        field: 'properties.knowledgeSetId.__raw__',\n                        op: 'EQUAL',\n                        values: [knowledgeItem.id]\n                    ]\n                ]\n            ]\n        }\n    ]\n    combinedFilter['values'].add(knowledgeSetFilter)\n}\n\n// archivedRawDataIds Filter\ndef archivedRawDataFilter = null\nif (binding.hasVariable('archivedRawDataIds')) {\n    archivedRawDataFilter = [\n        op: 'AND',\n        values: [\n            [\n                field: 'properties.uniqueEntityId',\n                op: 'NOT_IN',\n                values: archivedRawDataIds\n            ],\n            [\n                field: 'properties.uniqueEntityId.__raw__',\n                op: 'NOT_IN',\n                values: archivedRawDataIds\n            ]   \n        ]\n    ]\n    combinedFilter['values'].add(archivedRawDataFilter)\n}\n\n// Handle new filter format\nif (binding.hasVariable('filter') && filter instanceof Map && filter.containsKey('op') && filter.containsKey('values')) {\n    filter.values.each { filterElement ->\n        def processedElement = processFilterElement(filterElement)\n        combinedFilter['values'].add(processedElement)\n    }\n}\n\n// Helper function to recursively process filter elements and lowercase string values\ndef processFilterElement(element) {\n    if (element instanceof Map) {\n        def processed = [:]\n        element.each { key, value ->\n            if (key == 'values' && value instanceof List) {\n                processed[key] = value.collect { v ->\n                    if (v instanceof String) {\n                        return v.toLowerCase()\n                    } else if (v instanceof Map || v instanceof List) {\n                        return processFilterElement(v)\n                    } else {\n                        return v\n                    }\n                }\n            } else if (value instanceof Map || value instanceof List) {\n                processed[key] = processFilterElement(value)\n            } else {\n                processed[key] = value\n            }\n        }\n        return processed\n    } else if (element instanceof List) {\n        return element.collect { item ->\n            processFilterElement(item)\n        }\n    } else {\n        return element\n    }\n}\n\n// Combine with additionalFilter if it exists\ndef finalFilter = null\ndef validAdditionalFilter = (binding.hasVariable('additionalFilter') &&\n                             additionalFilter instanceof Map &&\n                             additionalFilter.containsKey('op') &&\n                             additionalFilter.containsKey('values'))\n\ndef validCombinedFilter = combinedFilter['values'].size() > 0\n\nif (validCombinedFilter && validAdditionalFilter) {\n    finalFilter = [\n        op: 'AND',\n        values: [\n            additionalFilter,\n            combinedFilter\n        ]\n    ]\n} else if (validCombinedFilter) {\n    finalFilter = combinedFilter\n} else if (validAdditionalFilter) {\n    finalFilter = additionalFilter\n}\n\nreturn ['filter': finalFilter]\n",
				"compile_static":false,
				"isAsync":false,
				"captureStdOutput":false,
				"parameters":{
					"filter":"{{ le3y3.outputs.filter }}",
					"additionalFilter":"{{ _94gvN.outputs.additionalFilter }}",
					"sharedWithIds":{
						"ua:type":"mappedArray",
						"items":"{{ le3y3.outputs.sharedWithIds[0] }}",
						"source":"{{ le3y3.outputs.sharedWithIds }}"
					},
					"knowledgeSet":{
						"ua:type":"mappedArray",
						"source":"{{ _UlrMo.outputs.objects }}",
						"items":{
							"id":"{{ _UlrMo.outputs.objects[0].id }}"
						}
					},
					"archivedRawDataIds":{
						"source":"{{ le3y3.outputs.archivedRawDataIds }}",
						"ua:type":"mappedArray",
						"items":"{{ le3y3.outputs.archivedRawDataIds[0] }}"
					}
				}
			},
			"skip":false,
			"subTitle":"Filter",
			"title":"Execute groovy code",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"variable_by_unifyapps",
				"resourceVersion":458,
				"resourceName":"variable_by_unifyapps_create_variables",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_ZeXKb@_KwFz2@qoogX-1@y@l",
			"id":"n_Auu7o",
			"index":18,
			"inputSchema":{
				"type":"SCHEMA_AND_LAYOUT",
				"dynamic":false,
				"layout":{},
				"schema":{
					"additionalProperties":false,
					"type":"object",
					"properties":{
						"startTime":{
							"type":"integer",
							"title":"Start Time"
						},
						"input":{
							"type":"object",
							"properties":{
								"userQuery":{
									"type":"string",
									"title":"User Query"
								},
								"embeddingModel":{
									"type":"string",
									"title":"Embedding Model"
								}
							},
							"additionalProperties":false,
							"title":"Input",
							"required":[]
						}
					},
					"required":[]
				}
			},
			"inputs":{
				"input":{
					"userQuery":"{{ le3y3.outputs.userQuery }}",
					"embeddingModel":"{{ _ZeXKb.outputs.item.embeddingModel }}"
				},
				"startTime":"=INT((NOW() - DATE(1970,1,1)) * 86400000)"
			},
			"outputSchema":{
				"dynamic":false,
				"schema":{
					"additionalProperties":false,
					"type":"object",
					"properties":{
						"startTime":{
							"type":"integer",
							"title":"Start Time"
						},
						"input":{
							"type":"object",
							"properties":{
								"userQuery":{
									"type":"string",
									"title":"User Query"
								},
								"embeddingModel":{
									"type":"string",
									"title":"Embedding Model"
								}
							},
							"additionalProperties":false,
							"title":"Input",
							"required":[]
						}
					},
					"required":[]
				}
			},
			"skip":false,
			"subTitle":"startTime Variable",
			"title":"Create variables",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"callables",
				"resourceVersion":48,
				"resourceName":"callables_call_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"MANUAL",
			"groupId":"_ZeXKb@_KwFz2@qoogX-1@y@l",
			"id":"_XvvRo",
			"index":19,
			"inputs":{
				"automationId":"6784b9216fb83f0972c5625d",
				"runtimeConnections":{},
				"synchronous":true,
				"triggerWorkflowWithRuntimeType":"IN_MEMORY",
				"version":"-1",
				"parameters":{
					"userQuery":"{{ le3y3.outputs.userQuery }}",
					"modelId":"{{ _ZeXKb.outputs.item.embeddingModel }}"
				}
			},
			"options":{
				"bulkheadConfig":{
					"enabled":false,
					"maxLeaseTimeUnit":"SECONDS",
					"maxWaitDurationUnit":"SECONDS"
				},
				"businessHoursConfig":{
					"enabled":false,
					"waitForNextWindow":false
				},
				"cacheConfig":{
					"enabled":false,
					"usagePolicy":"ALWAYS"
				},
				"circuitBreakerConfig":{
					"enabled":false
				},
				"disableLogging":false,
				"enabledForReExecution":false,
				"hookConfig":{
					"enabled":false,
					"postHooks":[
						
					],
					"preHooks":[
						
					]
				},
				"logConfig":{
					"enabled":false,
					"logPolicies":[
						
					]
				},
				"rateLimitConfig":{
					"enabled":false,
					"waitForNextWindow":false
				},
				"retryConfig":{
					"backOffFactor":null,
					"captureRetries":false,
					"enabled":false
				},
				"stepError":"MANUAL",
				"telemetryConfig":{
					"enableTelemetry":false,
					"metricConfigs":[
						
					]
				}
			},
			"skip":false,
			"subTitle":"Fetch Embeddings ",
			"title":"Call automation",
			"type":"CALL_WORKFLOW"
		},
		{
			"context":{
				"appName":"callables",
				"resourceVersion":600,
				"resourceName":"callables_call_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_XvvRo@_ZeXKb@_KwFz2@qoogX-1@y@l@success",
			"id":"n_LCpO5",
			"index":20,
			"inputs":{
				"automationId":"680bb38e89c13d6ab6b7babe",
				"runtimeConnections":{},
				"synchronous":true,
				"version":"-1",
				"parameters":{
					"modelId":"{{ _XvvRo.outputs.usedModelId }}",
					"inputTokens":"{{ _XvvRo.outputs.usage.inputTokens }}",
					"outputTokens":"{{ _XvvRo.outputs.usage.outputTokens }}"
				}
			},
			"skip":false,
			"subTitle":"Callable",
			"title":"Call automation",
			"type":"CALL_WORKFLOW"
		},
		{
			"context":{
				"appName":"callables",
				"resourceVersion":467,
				"resourceName":"callables_call_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"CONTINUE",
			"groupId":"_XvvRo@_ZeXKb@_KwFz2@qoogX-1@y@l@success",
			"id":"n_4np6g",
			"index":21,
			"inputs":{
				"automationId":"68c51597269ad81cc750a3ca",
				"runtimeConnections":{},
				"synchronous":false,
				"triggerWorkflowWithRuntimeType":"IN_MEMORY",
				"version":"-1",
				"parameters":{
					"caseId":"{{ 53LAF.outputs.caseId }}",
					"aiAgentId":"{{ 53LAF.outputs.aiAgentId }}",
					"modelId":"{{ _XvvRo.outputs.usedModelId }}",
					"inputToken":"{{ _XvvRo.outputs.usage.inputTokens }}",
					"outputToken":"{{ _XvvRo.outputs.usage.outputTokens }}",
					"cost":"=SUM({{ n_LCpO5.outputs.inputTokenCost }},{{ n_LCpO5.outputs.outputTokenCost }})",
					"executionInstanceId":"{{ _XvvRo.outputs.executionInstanceId }}",
					"parent":"Retrieval",
					"messageId":"{{ 53LAF.outputs.messageId }}",
					"llmTimeTaken":"=INT((NOW() - DATE(1970,1,1)) * 86400000)-{{ n_Auu7o.outputs.startTime }}",
					"input":"{{ n_Auu7o.outputs.input }}",
					"currentType":"Fetch Embeddings",
					"inputTokenCost":"{{ n_LCpO5.outputs.inputTokenCost }}",
					"outputTokenCost":"{{ n_LCpO5.outputs.outputTokenCost }}",
					"rootExecutionId":"{{ __RUN__.outputs.rootExecutionId }}",
					"parentExecutionId":"{{ __RUN__.outputs.executionId }}",
					"userId":"=IF(ISNUMBER({{ __RUN__.outputs.userId }}), {{ __RUN__.outputs.userId }}, 0)",
					"fromAutomationId":"6784b9216fb83f0972c5625d",
					"startTime":"{{ n_Auu7o.outputs.startTime }}",
					"success":true
				}
			},
			"options":{
				"bulkheadConfig":{
					"enabled":false,
					"maxLeaseTimeUnit":"SECONDS",
					"maxWaitDurationUnit":"SECONDS"
				},
				"businessHoursConfig":{
					"enabled":false,
					"waitForNextWindow":false
				},
				"cacheConfig":{
					"enabled":false,
					"usagePolicy":"ALWAYS"
				},
				"circuitBreakerConfig":{
					"enabled":false
				},
				"disableLogging":false,
				"enabledForReExecution":false,
				"hookConfig":{
					"enabled":false,
					"postHooks":[
						
					],
					"preHooks":[
						
					]
				},
				"logConfig":{
					"enabled":false,
					"logPolicies":[
						
					]
				},
				"rateLimitConfig":{
					"enabled":false,
					"waitForNextWindow":false
				},
				"retryConfig":{
					"backOffFactor":null,
					"captureRetries":false,
					"enabled":false
				},
				"stepError":"CONTINUE",
				"telemetryConfig":{
					"enableTelemetry":false,
					"metricConfigs":[
						
					]
				}
			},
			"skip":false,
			"subTitle":"Capture Trace",
			"title":"Call automation",
			"type":"CALL_WORKFLOW"
		},
		{
			"context":{
				"appName":"callables",
				"resourceVersion":467,
				"resourceName":"callables_call_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"CONTINUE",
			"groupId":"_XvvRo@_ZeXKb@_KwFz2@qoogX-1@y@l@error",
			"id":"_cyNOJ",
			"index":22,
			"inputs":{
				"automationId":"68c51597269ad81cc750a3ca",
				"runtimeConnections":{},
				"synchronous":false,
				"triggerWorkflowWithRuntimeType":"IN_MEMORY",
				"version":"-1",
				"parameters":{
					"caseId":"{{ 53LAF.outputs.caseId }}",
					"aiAgentId":"{{ 53LAF.outputs.aiAgentId }}",
					"executionInstanceId":"{{ __RUN__.outputs.executionId }}",
					"parent":"Retrieval",
					"messageId":"{{ 53LAF.outputs.messageId }}",
					"llmTimeTaken":"=INT((NOW() - DATE(1970,1,1)) * 86400000)-{{ n_Auu7o.outputs.startTime }}",
					"input":"{{ n_Auu7o.outputs.input }}",
					"currentType":"Fetch Embeddings",
					"rootExecutionId":"{{ __RUN__.outputs.rootExecutionId }}",
					"parentExecutionId":"{{ __RUN__.outputs.parentExecutionId }}",
					"userId":"=IF(ISNUMBER({{ __RUN__.outputs.userId }}), {{ __RUN__.outputs.userId }}, 0)",
					"output":"{{ _XvvRo.outputs }}",
					"fromAutomationId":"679b7fdad2256d4d7f3277fe",
					"startTime":"{{ n_Auu7o.outputs.startTime }}",
					"success":false
				}
			},
			"options":{
				"bulkheadConfig":{
					"enabled":false,
					"maxLeaseTimeUnit":"SECONDS",
					"maxWaitDurationUnit":"SECONDS"
				},
				"businessHoursConfig":{
					"enabled":false,
					"waitForNextWindow":false
				},
				"cacheConfig":{
					"enabled":false,
					"usagePolicy":"ALWAYS"
				},
				"circuitBreakerConfig":{
					"enabled":false
				},
				"disableLogging":false,
				"enabledForReExecution":false,
				"hookConfig":{
					"enabled":false,
					"postHooks":[
						
					],
					"preHooks":[
						
					]
				},
				"logConfig":{
					"enabled":false,
					"logPolicies":[
						
					]
				},
				"rateLimitConfig":{
					"enabled":false,
					"waitForNextWindow":false
				},
				"retryConfig":{
					"backOffFactor":null,
					"captureRetries":false,
					"enabled":false
				},
				"stepError":"CONTINUE",
				"telemetryConfig":{
					"enableTelemetry":false,
					"metricConfigs":[
						
					]
				}
			},
			"skip":false,
			"subTitle":"Capture Trace",
			"title":"Call automation",
			"type":"CALL_WORKFLOW"
		},
		{
			"context":{
				"appName":"callables",
				"resourceVersion":467,
				"resourceName":"callables_call_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_XvvRo@_ZeXKb@_KwFz2@qoogX-1@y@l@error",
			"id":"n_yZT3b",
			"index":23,
			"inputs":{
				"automationId":"68b827559a4a9d0149caa07d",
				"runtimeConnections":{},
				"synchronous":true,
				"version":"-1",
				"parameters":{
					"errorDetails":"{{ _XvvRo.outputs }}",
					"caseId":"{{ 53LAF.outputs.caseId }}",
					"messageId":"{{ 53LAF.outputs.messageId }}"
				}
			},
			"skip":false,
			"subTitle":"Throw Error",
			"title":"Call automation",
			"type":"CALL_WORKFLOW"
		},
		{
			"context":{
				"appName":"callables",
				"resourceVersion":205,
				"resourceName":"callables_call_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_ZeXKb@_KwFz2@qoogX-1@y@l",
			"id":"_yhHvW",
			"index":24,
			"inputs":{
				"automationId":"6784ec5e2bf24b00b3976630",
				"runtimeConnections":{},
				"synchronous":true,
				"version":"-1",
				"parameters":{
					"filter":"{{ _keZUp.outputs.result.filter }}",
					"query":"{{ le3y3.outputs.userQuery }}",
					"vectorStore":"{{ _ZeXKb.outputs.item.vectorStore }}",
					"vectorStoreConnectionId":"{{ _ZeXKb.outputs.item.vectorStoreConnectionId }}",
					"embeddings":{
						"source":"{{ _XvvRo.outputs.embeddings }}",
						"ua:type":"mappedArray",
						"items":"{{ _XvvRo.outputs.embeddings[0] }}"
					}
				}
			},
			"skip":false,
			"subTitle":"Chunk Fetcher",
			"title":"Call automation",
			"type":"CALL_WORKFLOW"
		},
		{
			"additional":{
				"visibleOptionalFields":[
					"root.itemsToAdd.items.score",
					"root.itemsToAdd.items.document",
					"root.itemsToAdd.items.knowledgeType"
				]
			},
			"context":{
				"appName":"variable_by_unifyapps",
				"resourceVersion":10,
				"resourceName":"variable_by_unifyapps_add_items_to_list",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_ZeXKb@_KwFz2@qoogX-1@y@l",
			"id":"_F80jl",
			"index":25,
			"inputs":{
				"insertLocation":"END",
				"itemsToAdd":{
					"ua:type":"mappedArray",
					"items":{
						"score":"{{ _yhHvW.outputs.records[0].score }}",
						"document":"{{ _yhHvW.outputs.records[0].document }}"
					},
					"source":"{{ _yhHvW.outputs.records }}"
				},
				"listName":"{{ _LDYaq.outputs.items[0] }}"
			},
			"skip":false,
			"subTitle":"relevantChunks",
			"title":"Add items to list",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"loop",
				"resourceVersion":215,
				"resourceName":"loop_for_each",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"qoogX-1",
			"id":"GJSUp",
			"index":26,
			"inputs":{
				"repeatMode":"SINGLE",
				"listSource":"{{ do2nR.outputs.result.embeddingVsKnowledgeFilter }}",
				"captureIterations":false
			},
			"skip":false,
			"subTitle":"embeddings",
			"title":"For loop",
			"type":"LOOP"
		},
		{
			"context":{
				"appName":"storage_by_unifyapps",
				"resourceVersion":16,
				"resourceName":"storage_by_unifyapps_fetch_records",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"GJSUp@qoogX-1@l",
			"id":"7AvkW",
			"index":27,
			"inputs":{
				"triggerInputCondition":{
					"filters":[
						{
							"resolvedFilter":{
								"filter":"{{ GJSUp.outputs.item.knowledgeFilter }}"
							}
						},
						{
							"property":"properties_knowledgeSetId",
							"filter":{
								"operator":"NOT_IN",
								"value":"{{ n_TuMfu.outputs.items }}"
							}
						}
					],
					"operator":"AND"
				},
				"object_type":"knowledge",
				"includeRoleMappings":false,
				"includeCurrentUserPermissions":false,
				"translationsOption":"DEFAULT",
				"page":{
					"paginateBy":"OFFSET",
					"limit":50
				},
				"numberOfRecordsToFetch":"MULTIPLE",
				"readThroughSessionVariables":false,
				"includeTotalCount":false,
				"fetchDeployedEntity":"{{ 53LAF.outputs.ai_agent_use_deployed_entity }}",
				"deployedEntityVersion":"{{ 53LAF.outputs.ai_agent_deployed_version }}"
			},
			"skip":false,
			"subTitle":"knowledge",
			"title":"Fetch records",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"if_else",
				"resourceVersion":444,
				"resourceName":"if_else_condition",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"GJSUp@qoogX-1@l",
			"id":"n_OgZ1z",
			"index":28,
			"inputs":{
				"filters":[
					{
						"property":"=LEN({{ 7AvkW.outputs.objects }})",
						"filter":{
							"operator":"EQUAL",
							"value":"0"
						}
					}
				],
				"operator":"AND"
			},
			"skip":false,
			"subTitle":"Condition",
			"title":"Condition",
			"type":"IF_ELSE"
		},
		{
			"context":{
				"appName":"continue",
				"resourceVersion":151,
				"resourceName":"continue",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"n_OgZ1z@GJSUp@qoogX-1@l@y",
			"id":"_waB5G",
			"index":29,
			"inputs":{
				"loop":"GJSUp"
			},
			"skip":false,
			"subTitle":"Continue",
			"title":"Continue",
			"type":"CONTINUE"
		},
		{
			"context":{
				"appName":"variable_by_unifyapps",
				"resourceVersion":17,
				"resourceName":"variable_by_unifyapps_create_variables",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"GJSUp@qoogX-1@l",
			"id":"lr0UB",
			"index":30,
			"inputSchema":{
				"type":"SCHEMA_AND_LAYOUT",
				"dynamic":false,
				"layout":{},
				"schema":{
					"additionalProperties":false,
					"type":"object",
					"properties":{
						"additionalFilter":{
							"type":"object",
							"properties":{},
							"additionalProperties":false,
							"title":"Additional Filter"
						}
					},
					"required":[]
				}
			},
			"inputs":{},
			"outputSchema":{
				"dynamic":false,
				"schema":{
					"additionalProperties":false,
					"type":"object",
					"properties":{
						"additionalFilter":{
							"type":"object",
							"properties":{},
							"additionalProperties":false,
							"title":"Additional Filter"
						},
						"_ua_variableDetails":{
							"items":{
								"properties":{
									"dataType":{
										"description":"Data type of the variable",
										"type":"string"
									},
									"description":{
										"description":"Description of the variable",
										"type":"string"
									},
									"name":{
										"description":"Name of the variable",
										"type":"string"
									}
								},
								"type":"object"
							},
							"title":"Variable Details",
							"type":"array"
						}
					},
					"required":[]
				}
			},
			"skip":false,
			"subTitle":"additionalFilter",
			"title":"Create variables",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"if_else",
				"resourceVersion":16,
				"resourceName":"if_else_condition",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"GJSUp@qoogX-1@l",
			"id":"nLE0z",
			"index":31,
			"inputs":{
				"filters":[
					{
						"property":"{{ le3y3.outputs.includeCustomMetadataFilter }}",
						"filter":{
							"operator":"EQUAL",
							"value":"true"
						}
					}
				],
				"operator":"AND"
			},
			"skip":false,
			"subTitle":"custom metadata filter?",
			"title":"Condition",
			"type":"IF_ELSE"
		},
		{
			"context":{
				"appName":"callables",
				"resourceVersion":11,
				"resourceName":"callables_call_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"nLE0z@GJSUp@qoogX-1@l@y",
			"id":"_dGN2s",
			"index":32,
			"inputs":{
				"automationId":"6762c6bfaaaee539c3421ac7",
				"runtimeConnections":{},
				"synchronous":true,
				"version":"-1",
				"parameters":{
					"userQuery":"{{ le3y3.outputs.userQuery }}",
					"knowledges":{
						"ua:type":"mappedArray",
						"items":{
							"customMetadata":{
								"ua:type":"mappedArray",
								"source":"{{ 7AvkW.outputs.objects[0].properties.customMetadata }}",
								"items":"{{ 7AvkW.outputs.objects[0].properties.customMetadata[0] }}"
							},
							"knowledgeId":"{{ 7AvkW.outputs.objects[0].id }}"
						},
						"source":"{{ 7AvkW.outputs.objects }}"
					}
				}
			},
			"skip":false,
			"subTitle":"custom metadata filter",
			"title":"Call automation",
			"type":"CALL_WORKFLOW"
		},
		{
			"context":{
				"appName":"if_else",
				"resourceVersion":439,
				"resourceName":"if_else_condition",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"nLE0z@GJSUp@qoogX-1@l@y",
			"id":"n_eC5KA",
			"index":33,
			"inputs":{
				"filters":[
					{
						"property":"{{ _dGN2s.outputs.filter }}",
						"filter":{
							"operator":"MISSING"
						}
					}
				],
				"operator":"AND"
			},
			"skip":false,
			"subTitle":"Condition",
			"title":"Condition",
			"type":"IF_ELSE"
		},
		{
			"additional":{
				"visibleOptionalFields":[
					"root.result.relevantContent.source",
					"root.result.relevantContent.ua:type"
				]
			},
			"context":{
				"appName":"callables",
				"resourceVersion":16,
				"resourceName":"callables_return_to_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"n_eC5KA@nLE0z@GJSUp@qoogX-1@l@y@y",
			"id":"_NzqcM",
			"index":34,
			"inputs":{
				"result":{
					"relevantContent":{
						"source":"{{ _LDYaq.outputs.items }}",
						"ua:type":"mappedArray",
						"items":{
							"score":"{{ _LDYaq.outputs.items[0].score }}",
							"document":"{{ _LDYaq.outputs.items[0].document }}"
						}
					}
				}
			},
			"skip":false,
			"subTitle":"Callable",
			"title":"Respond to automation",
			"type":"STOP"
		},
		{
			"context":{
				"appName":"variable_by_unifyapps",
				"resourceVersion":16,
				"resourceName":"variable_by_unifyapps_update_variables",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"nLE0z@GJSUp@qoogX-1@l@y",
			"id":"9JXJ6",
			"index":35,
			"inputs":{
				"variables":[
					{
						"source":"{{ lr0UB.outputs.additionalFilter }}",
						"value":"{{ _dGN2s.outputs.filter }}"
					}
				]
			},
			"skip":false,
			"subTitle":"Variable by UnifyApps",
			"title":"Update variables",
			"type":"ACTION"
		},
		{
			"additional":{
				"visibleOptionalFields":[
					"root.parameters.sharedWithIds.items",
					"root.parameters.knowledgeList.items.id",
					"root.parameters.knowledgeList.items.version",
					"root.parameters.knowledgeList.items.sourceType",
					"root.parameters.archivedRawDataIds.items"
				]
			},
			"context":{
				"appName":"code_by_unifyapps",
				"resourceVersion":52,
				"resourceName":"code_by_unifyapps_groovy",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"GJSUp@qoogX-1@l",
			"id":"PXUiF",
			"index":36,
			"inputs":{
				"output":{
					"type":"object",
					"additionalProperties":false,
					"required":[],
					"properties":{
						"filter":{
							"type":"object",
							"title":"filter"
						}
					}
				},
				"input":{
					"type":"object",
					"additionalProperties":false,
					"required":[],
					"properties":{
						"sharedWithIds":{
							"type":"array",
							"items":{
								"type":"string"
							},
							"title":"sharedWithIds"
						},
						"knowledgeList":{
							"type":"array",
							"items":{
								"type":"object",
								"properties":{
									"id":{
										"type":"string",
										"title":"Id"
									},
									"version":{
										"type":"number",
										"title":"Version"
									},
									"sourceType":{
										"type":"string",
										"title":"Source Type"
									}
								},
								"additionalProperties":false
							},
							"title":"Knowledge List",
							"required":[]
						},
						"additionalFilter":{
							"type":"object",
							"properties":{},
							"additionalProperties":false,
							"title":"Additional Filter"
						},
						"filter":{
							"type":"object",
							"properties":{},
							"additionalProperties":false,
							"title":"Filter"
						},
						"archivedRawDataIds":{
							"type":"array",
							"items":{
								"type":"string"
							},
							"title":"Archived Raw Data Ids"
						}
					}
				},
				"code":"def combinedFilter = [\n    op: 'AND',\n    values: []\n]\n\n// SharedWithIds Filter\ndef sharedFilter = null\nif (binding.hasVariable('sharedWithIds')) {\n    sharedFilter = [\n        field: 'properties.sharedWithIds',\n        op: 'IN',\n        values: sharedWithIds\n    ]\n    combinedFilter['values'].add(sharedFilter)\n}\n\ndef knowledgeFilter = null\n\n//KnowledgeFilter\nif (binding.hasVariable('knowledgeList')) {\n    if (knowledgeList) {\n        knowledgeFilter = [\n            op: 'OR',\n            values: knowledgeList.collect { knowledgeItem ->\n                [\n                    op: 'AND',\n                    values: [\n                        [\n                            field: 'properties.knowledgeId',\n                            op: 'EQUAL',\n                            values: [knowledgeItem.id]\n                        ],\n                        knowledgeItem.version ? [\n                            op: 'OR',\n                            values: [\n                                [\n                                    field: 'properties.knowledgeVersion',\n                                    op: 'MISSING'\n                                ],\n                                [\n                                    field: 'properties.knowledgeVersion',\n                                    op: 'EQUAL',\n                                    values: [knowledgeItem.version.intValue()]\n                                ]\n                            ]\n                        ] : [\n                            field: 'properties.knowledgeVersion',\n                            op: 'MISSING'\n                        ]\n                    ]\n                ]\n            }\n        ]\n        combinedFilter['values'].add(knowledgeFilter)\n    }\n}\n\n// archivedRawDataIds Filter\ndef archivedRawDataFilter = null\nif (binding.hasVariable('archivedRawDataIds')) {\n    archivedRawDataFilter = [\n        op: 'AND',\n        values: [\n            [\n                field: 'properties.uniqueEntityId',\n                op: 'NOT_IN',\n                values: archivedRawDataIds\n            ],\n            [\n                field: 'properties.uniqueEntityId.__raw__',\n                op: 'NOT_IN',\n                values: archivedRawDataIds\n            ]   \n        ]\n    ]\n    combinedFilter['values'].add(archivedRawDataFilter)\n}\n\n// Handle new filter format\nif (binding.hasVariable('filter') && filter instanceof Map && filter.containsKey('op') && filter.containsKey('values')) {\n    filter.values.each { filterElement ->\n        def processedElement = processFilterElement(filterElement)\n        combinedFilter['values'].add(processedElement)\n    }\n}\n\n// Helper function to recursively process filter elements and lowercase string values\ndef processFilterElement(element) {\n    if (element instanceof Map) {\n        def processed = [:]\n        element.each { key, value ->\n            if (key == 'values' && value instanceof List) {\n                processed[key] = value.collect { v ->\n                    if (v instanceof String) {\n                        return v.toLowerCase()\n                    } else if (v instanceof Map || v instanceof List) {\n                        return processFilterElement(v)\n                    } else {\n                        return v\n                    }\n                }\n            } else if (value instanceof Map || value instanceof List) {\n                processed[key] = processFilterElement(value)\n            } else {\n                processed[key] = value\n            }\n        }\n        return processed\n    } else if (element instanceof List) {\n        return element.collect { item ->\n            processFilterElement(item)\n        }\n    } else {\n        return element\n    }\n}\n\n// Combine with additionalFilter if it exists\ndef finalFilter = null\ndef validAdditionalFilter = (binding.hasVariable('additionalFilter') &&\n                             additionalFilter instanceof Map &&\n                             additionalFilter.containsKey('op') &&\n                             additionalFilter.containsKey('values'))\n\ndef validCombinedFilter = combinedFilter['values'].size() > 0\n\nif (validCombinedFilter && validAdditionalFilter) {\n    finalFilter = [\n        op: 'AND',\n        values: [\n            additionalFilter,\n            combinedFilter\n        ]\n    ]\n} else if (validCombinedFilter) {\n    finalFilter = combinedFilter\n} else if (validAdditionalFilter) {\n    finalFilter = additionalFilter\n}\n\nreturn ['filter': finalFilter]\n",
				"compile_static":false,
				"isAsync":false,
				"captureStdOutput":false,
				"parameters":{
					"additionalFilter":"{{ lr0UB.outputs.additionalFilter }}",
					"filter":"{{ le3y3.outputs.filter }}",
					"sharedWithIds":{
						"ua:type":"mappedArray",
						"source":"{{ le3y3.outputs.sharedWithIds }}",
						"items":"{{ le3y3.outputs.sharedWithIds[0] }}"
					},
					"knowledgeList":{
						"ua:type":"mappedArray",
						"items":{
							"id":"{{ 7AvkW.outputs.objects[0].id }}",
							"version":"{{ 7AvkW.outputs.objects[0].properties.readVersion }}",
							"sourceType":"{{ 7AvkW.outputs.objects[0].properties.sourceType }}"
						},
						"source":"{{ 7AvkW.outputs.objects }}"
					},
					"archivedRawDataIds":{
						"source":"{{ le3y3.outputs.archivedRawDataIds }}",
						"ua:type":"mappedArray",
						"items":"{{ le3y3.outputs.archivedRawDataIds[0] }}"
					}
				}
			},
			"skip":false,
			"subTitle":"semantic search filter",
			"title":"Execute groovy code",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"variable_by_unifyapps",
				"resourceVersion":458,
				"resourceName":"variable_by_unifyapps_create_variables",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"GJSUp@qoogX-1@l",
			"id":"_DLXc9",
			"index":37,
			"inputSchema":{
				"type":"SCHEMA_AND_LAYOUT",
				"dynamic":false,
				"layout":{},
				"schema":{
					"additionalProperties":false,
					"type":"object",
					"properties":{
						"startTime":{
							"type":"integer",
							"title":"Start Time"
						},
						"input":{
							"type":"object",
							"properties":{
								"userQuery":{
									"type":"string",
									"title":"User Query"
								},
								"embeddingModel":{
									"type":"string",
									"title":"Embedding Model"
								}
							},
							"additionalProperties":false,
							"title":"Input",
							"required":[]
						}
					},
					"required":[]
				}
			},
			"inputs":{
				"input":{
					"userQuery":"{{ le3y3.outputs.userQuery }}",
					"embeddingModel":"{{ GJSUp.outputs.item.embeddingModel }}"
				},
				"startTime":"=INT((NOW() - DATE(1970,1,1)) * 86400000)"
			},
			"outputSchema":{
				"dynamic":false,
				"schema":{
					"additionalProperties":false,
					"type":"object",
					"properties":{
						"startTime":{
							"type":"integer",
							"title":"Start Time"
						},
						"input":{
							"type":"object",
							"properties":{
								"userQuery":{
									"type":"string",
									"title":"User Query"
								},
								"embeddingModel":{
									"type":"string",
									"title":"Embedding Model"
								}
							},
							"additionalProperties":false,
							"title":"Input",
							"required":[]
						}
					},
					"required":[]
				}
			},
			"skip":false,
			"subTitle":"startTime Variable",
			"title":"Create variables",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"callables",
				"resourceVersion":48,
				"resourceName":"callables_call_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"MANUAL",
			"groupId":"GJSUp@qoogX-1@l",
			"id":"Ymh6A",
			"index":38,
			"inputs":{
				"automationId":"6784b9216fb83f0972c5625d",
				"runtimeConnections":{},
				"synchronous":true,
				"version":"-1",
				"parameters":{
					"userQuery":"{{ le3y3.outputs.userQuery }}",
					"modelId":"{{ GJSUp.outputs.item.embeddingModel }}"
				}
			},
			"options":{
				"bulkheadConfig":{
					"enabled":false,
					"maxLeaseTimeUnit":"SECONDS",
					"maxWaitDurationUnit":"SECONDS"
				},
				"businessHoursConfig":{
					"enabled":false,
					"waitForNextWindow":false
				},
				"cacheConfig":{
					"enabled":false,
					"usagePolicy":"ALWAYS"
				},
				"circuitBreakerConfig":{
					"enabled":false
				},
				"disableLogging":false,
				"enabledForReExecution":false,
				"hookConfig":{
					"enabled":false,
					"postHooks":[
						
					],
					"preHooks":[
						
					]
				},
				"logConfig":{
					"enabled":false,
					"logPolicies":[
						
					]
				},
				"rateLimitConfig":{
					"enabled":false,
					"waitForNextWindow":false
				},
				"retryConfig":{
					"backOffFactor":null,
					"captureRetries":false,
					"enabled":false
				},
				"stepError":"MANUAL",
				"telemetryConfig":{
					"enableTelemetry":false,
					"metricConfigs":[
						
					]
				}
			},
			"skip":false,
			"subTitle":"Fetch Embeddings ",
			"title":"Call automation",
			"type":"CALL_WORKFLOW"
		},
		{
			"context":{
				"appName":"callables",
				"resourceVersion":467,
				"resourceName":"callables_call_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"CONTINUE",
			"groupId":"Ymh6A@GJSUp@qoogX-1@l@success",
			"id":"_IMnXd",
			"index":39,
			"inputs":{
				"automationId":"68c51597269ad81cc750a3ca",
				"runtimeConnections":{},
				"synchronous":false,
				"triggerWorkflowWithRuntimeType":"IN_MEMORY",
				"version":"-1",
				"parameters":{
					"caseId":"{{ 53LAF.outputs.caseId }}",
					"aiAgentId":"{{ 53LAF.outputs.aiAgentId }}",
					"executionInstanceId":"{{ Ymh6A.outputs.executionInstanceId }}",
					"parent":"Retrieval",
					"messageId":"{{ 53LAF.outputs.messageId }}",
					"llmTimeTaken":"=INT((NOW() - DATE(1970,1,1)) * 86400000)-{{ _DLXc9.outputs.startTime }}",
					"input":"{{ _DLXc9.outputs.input }}",
					"currentType":"Fetch Embeddings",
					"rootExecutionId":"{{ __RUN__.outputs.rootExecutionId }}",
					"parentExecutionId":"{{ __RUN__.outputs.executionId }}",
					"userId":"=IF(ISNUMBER({{ __RUN__.outputs.userId }}), {{ __RUN__.outputs.userId }}, 0)",
					"fromAutomationId":"6784b9216fb83f0972c5625d",
					"startTime":"{{ _DLXc9.outputs.startTime }}",
					"success":true
				}
			},
			"options":{
				"bulkheadConfig":{
					"enabled":false,
					"maxLeaseTimeUnit":"SECONDS",
					"maxWaitDurationUnit":"SECONDS"
				},
				"businessHoursConfig":{
					"enabled":false,
					"waitForNextWindow":false
				},
				"cacheConfig":{
					"enabled":false,
					"usagePolicy":"ALWAYS"
				},
				"circuitBreakerConfig":{
					"enabled":false
				},
				"disableLogging":false,
				"enabledForReExecution":false,
				"hookConfig":{
					"enabled":false,
					"postHooks":[
						
					],
					"preHooks":[
						
					]
				},
				"logConfig":{
					"enabled":false,
					"logPolicies":[
						
					]
				},
				"rateLimitConfig":{
					"enabled":false,
					"waitForNextWindow":false
				},
				"retryConfig":{
					"backOffFactor":null,
					"captureRetries":false,
					"enabled":false
				},
				"stepError":"CONTINUE",
				"telemetryConfig":{
					"enableTelemetry":false,
					"metricConfigs":[
						
					]
				}
			},
			"skip":false,
			"subTitle":"Capture Trace",
			"title":"Call automation",
			"type":"CALL_WORKFLOW"
		},
		{
			"context":{
				"appName":"callables",
				"resourceVersion":467,
				"resourceName":"callables_call_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"CONTINUE",
			"groupId":"Ymh6A@GJSUp@qoogX-1@l@error",
			"id":"_KLlkQ",
			"index":40,
			"inputs":{
				"automationId":"68c51597269ad81cc750a3ca",
				"runtimeConnections":{},
				"synchronous":false,
				"triggerWorkflowWithRuntimeType":"IN_MEMORY",
				"version":"-1",
				"parameters":{
					"caseId":"{{ 53LAF.outputs.caseId }}",
					"aiAgentId":"{{ 53LAF.outputs.aiAgentId }}",
					"executionInstanceId":"{{ __RUN__.outputs.executionId }}",
					"parent":"Retrieval",
					"messageId":"{{ 53LAF.outputs.messageId }}",
					"llmTimeTaken":"=INT((NOW() - DATE(1970,1,1)) * 86400000)-{{ _DLXc9.outputs.startTime }}",
					"input":"{{ _DLXc9.outputs.input }}",
					"currentType":"Fetch Embeddings",
					"rootExecutionId":"{{ __RUN__.outputs.rootExecutionId }}",
					"parentExecutionId":"{{ __RUN__.outputs.parentExecutionId }}",
					"userId":"=IF(ISNUMBER({{ __RUN__.outputs.userId }}), {{ __RUN__.outputs.userId }}, 0)",
					"output":"{{ Ymh6A.outputs }}",
					"fromAutomationId":"679b7fdad2256d4d7f3277fe",
					"startTime":"{{ _DLXc9.outputs.startTime }}",
					"success":false
				}
			},
			"options":{
				"bulkheadConfig":{
					"enabled":false,
					"maxLeaseTimeUnit":"SECONDS",
					"maxWaitDurationUnit":"SECONDS"
				},
				"businessHoursConfig":{
					"enabled":false,
					"waitForNextWindow":false
				},
				"cacheConfig":{
					"enabled":false,
					"usagePolicy":"ALWAYS"
				},
				"circuitBreakerConfig":{
					"enabled":false
				},
				"disableLogging":false,
				"enabledForReExecution":false,
				"hookConfig":{
					"enabled":false,
					"postHooks":[
						
					],
					"preHooks":[
						
					]
				},
				"logConfig":{
					"enabled":false,
					"logPolicies":[
						
					]
				},
				"rateLimitConfig":{
					"enabled":false,
					"waitForNextWindow":false
				},
				"retryConfig":{
					"backOffFactor":null,
					"captureRetries":false,
					"enabled":false
				},
				"stepError":"CONTINUE",
				"telemetryConfig":{
					"enableTelemetry":false,
					"metricConfigs":[
						
					]
				}
			},
			"skip":false,
			"subTitle":"Capture Trace",
			"title":"Call automation",
			"type":"CALL_WORKFLOW"
		},
		{
			"context":{
				"appName":"callables",
				"resourceVersion":467,
				"resourceName":"callables_call_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"Ymh6A@GJSUp@qoogX-1@l@error",
			"id":"_LkfRx",
			"index":41,
			"inputs":{
				"automationId":"68b827559a4a9d0149caa07d",
				"runtimeConnections":{},
				"synchronous":true,
				"version":"-1",
				"parameters":{
					"errorDetails":"{{ Ymh6A.outputs }}",
					"caseId":"{{ 53LAF.outputs.caseId }}",
					"messageId":"{{ 53LAF.outputs.messageId }}"
				}
			},
			"skip":false,
			"subTitle":"Throw Error",
			"title":"Call automation",
			"type":"CALL_WORKFLOW"
		},
		{
			"context":{
				"appName":"callables",
				"resourceVersion":205,
				"resourceName":"callables_call_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"GJSUp@qoogX-1@l",
			"id":"fYHvJ",
			"index":42,
			"inputs":{
				"automationId":"6784ec5e2bf24b00b3976630",
				"runtimeConnections":{},
				"synchronous":true,
				"version":"-1",
				"parameters":{
					"filter":"{{ PXUiF.outputs.result.filter }}",
					"query":"{{ le3y3.outputs.userQuery }}",
					"vectorStore":"{{ GJSUp.outputs.item.vectorStore }}",
					"vectorStoreConnectionId":"{{ GJSUp.outputs.item.vectorStoreConnectionId }}",
					"embeddings":{
						"source":"{{ Ymh6A.outputs.embeddings }}",
						"ua:type":"mappedArray",
						"items":"{{ Ymh6A.outputs.embeddings[0] }}"
					}
				}
			},
			"skip":false,
			"subTitle":"chunk Fetcher",
			"title":"Call automation",
			"type":"CALL_WORKFLOW"
		},
		{
			"additional":{
				"visibleOptionalFields":[
					"root.itemsToAdd.items.score",
					"root.itemsToAdd.items.document",
					"root.itemsToAdd.items.knowledgeType"
				]
			},
			"context":{
				"appName":"variable_by_unifyapps",
				"resourceVersion":10,
				"resourceName":"variable_by_unifyapps_add_items_to_list",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"GJSUp@qoogX-1@l",
			"id":"oZ3KL",
			"index":43,
			"inputs":{
				"insertLocation":"END",
				"itemsToAdd":{
					"ua:type":"mappedArray",
					"items":{
						"score":"{{ fYHvJ.outputs.records[0].score }}",
						"document":"{{ fYHvJ.outputs.records[0].document }}"
					},
					"source":"{{ fYHvJ.outputs.records }}"
				},
				"listName":"{{ _LDYaq.outputs.items[0] }}"
			},
			"skip":false,
			"subTitle":"add relevant content",
			"title":"Add items to list",
			"type":"ACTION"
		},
		{
			"additional":{
				"visibleOptionalFields":[
					"root.parameters.relevantContent.items.score",
					"root.parameters.relevantContent.items.document"
				]
			},
			"context":{
				"appName":"code_by_unifyapps",
				"resourceVersion":288,
				"resourceName":"code_by_unifyapps_groovy",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"qoogX-1",
			"id":"HUjmx",
			"index":44,
			"inputs":{
				"output":{
					"type":"object",
					"properties":{
						"relevantContent":{
							"type":"array",
							"items":{
								"type":"object",
								"properties":{
									"score":{
										"type":"number",
										"title":"Score"
									},
									"document":{
										"type":"object",
										"properties":{},
										"additionalProperties":false,
										"title":"Document"
									}
								},
								"additionalProperties":false,
								"required":[]
							},
							"title":"Relevant Content"
						}
					},
					"additionalProperties":false,
					"required":[]
				},
				"input":{
					"type":"object",
					"properties":{
						"relevantContent":{
							"type":"array",
							"items":{
								"type":"object",
								"properties":{
									"score":{
										"type":"number",
										"title":"Score"
									},
									"document":{
										"type":"object",
										"properties":{},
										"additionalProperties":false,
										"title":"document"
									}
								},
								"additionalProperties":false,
								"required":[]
							},
							"title":"Relevant Content"
						}
					},
					"additionalProperties":false,
					"required":[]
				},
				"compile_static":false,
				"code":"if (binding.hasVariable('relevantContent') && !relevantContent?.isEmpty()) {\n  return [\n    'relevantContent': relevantContent.sort { -it.score }\n  ]\n}\n\nreturn [\n  'relevantContent' : []\n]",
				"parameters":{
					"relevantContent":{
						"source":"{{ _LDYaq.outputs.items }}",
						"ua:type":"mappedArray",
						"items":{
							"score":"{{ _LDYaq.outputs.items[0].score }}",
							"document":"{{ _LDYaq.outputs.items[0].document }}"
						}
					}
				}
			},
			"skip":false,
			"subTitle":"sort the chunks",
			"title":"Execute Groovy code",
			"type":"ACTION"
		},
		{
			"additional":{
				"visibleOptionalFields":[
					"root.result.relevantContent.source",
					"root.result.relevantContent.ua:type"
				]
			},
			"context":{
				"appName":"callables",
				"resourceVersion":16,
				"resourceName":"callables_return_to_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"qoogX-1",
			"id":"XYHEW",
			"index":45,
			"inputs":{
				"result":{
					"relevantContent":{
						"source":"{{ HUjmx.outputs.result.relevantContent }}",
						"ua:type":"mappedArray",
						"items":{
							"score":"{{ HUjmx.outputs.result.relevantContent[0].score }}",
							"document":"{{ HUjmx.outputs.result.relevantContent[0].document }}"
						}
					}
				}
			},
			"skip":false,
			"subTitle":"Callable",
			"title":"Respond to automation",
			"type":"STOP"
		}
	],
	"ownerUserId":1866,
	"schemaReferences":[
		
	],
	"settings":{
		"enableNodeLevelLogging":true,
		"enableRunLogging":true,
		"enableVariableLogging":true,
		"route":{
			"default":false,
			"tierName":"global"
		}
	},
	"standard":false,
	"tags":[
		"AI Agent",
		"Knowledge"
	],
	"version":98
}