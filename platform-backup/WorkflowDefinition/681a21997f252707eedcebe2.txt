{
	"appsUsed":[
		"openai",
		"storage_by_unifyapps"
	],
	"createdTime":1746701238325,
	"deleted":false,
	"deploymentState":{
		"deployedAt":1760296232350,
		"deployedBy":-1,
		"deployedDefinitionId":"68ebfd28672fcc41fb70f1a1",
		"status":"DEPLOYED",
		"version":53,
		"workflowVersion":70
	},
	"edges":[
		{
			"fromNodeId":"UZvws",
			"priority":0,
			"skip":false,
			"toNodeId":"TLZdN",
			"type":"next"
		},
		{
			"fromNodeId":"TLZdN",
			"priority":0,
			"skip":false,
			"toNodeId":"dXQMw",
			"type":"next"
		},
		{
			"fromNodeId":"dXQMw",
			"priority":0,
			"skip":false,
			"toNodeId":"F1Tvp",
			"type":"loop"
		},
		{
			"fromNodeId":"F1Tvp",
			"priority":0,
			"skip":false,
			"toNodeId":"HjYDq",
			"type":"next"
		},
		{
			"fromNodeId":"HjYDq",
			"name":"loopback",
			"priority":0,
			"skip":false,
			"toNodeId":"dXQMw",
			"type":"next"
		},
		{
			"fromNodeId":"dXQMw",
			"priority":0,
			"skip":false,
			"toNodeId":"VR6NJ",
			"type":"next"
		},
		{
			"fromNodeId":"VR6NJ",
			"name":"yes",
			"priority":0,
			"skip":false,
			"toNodeId":"S8Ssg",
			"type":"if"
		},
		{
			"fromNodeId":"S8Ssg",
			"priority":0,
			"skip":false,
			"toNodeId":"oJiRq",
			"type":"next"
		},
		{
			"fromNodeId":"oJiRq",
			"priority":0,
			"skip":false,
			"toNodeId":"EcX5Y",
			"type":"next"
		},
		{
			"fromNodeId":"VR6NJ",
			"name":"no",
			"priority":0,
			"skip":false,
			"toNodeId":"EcX5Y",
			"type":"next"
		}
	],
	"grants":{
		"configs":[
			{
				"permissions":[
					"V"
				],
				"principalType":"GLOBAL"
			}
		]
	},
	"id":"681a21997f252707eedcebe2",
	"lastModifiedBy":0,
	"lcName":"add messages to voice session",
	"modifiedTime":1761722773876,
	"name":"Add messages to voice session",
	"nodes":[
		{
			"context":{
				"appName":"callables",
				"resourceVersion":331,
				"resourceName":"callables_from_automation"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"25VJv-1",
			"id":"UZvws",
			"index":0,
			"inputs":{
				"result":{
					"type":"object",
					"properties":{
						"success":{
							"type":"string",
							"title":"Success"
						}
					},
					"additionalProperties":false,
					"required":[]
				},
				"setup":{
					"type":"object",
					"properties":{
						"messages":{
							"type":"array",
							"items":{
								"type":"object",
								"properties":{},
								"additionalProperties":false
							},
							"title":"Messages"
						},
						"session_id":{
							"type":"string",
							"title":"Session Id"
						},
						"triggerResponse":{
							"type":"boolean",
							"title":"Trigger Response"
						}
					},
					"additionalProperties":false,
					"required":[]
				}
			},
			"skip":false,
			"subTitle":"Callable",
			"title":"Trigger via automation",
			"trigger":{
				"type":"CALLABLE"
			},
			"type":"START"
		},
		{
			"additional":{
				"visibleOptionalFields":[
					"root.parameters.messages.items"
				]
			},
			"context":{
				"appName":"code_by_unifyapps",
				"resourceVersion":623,
				"resourceName":"code_by_unifyapps_groovy",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"25VJv-1",
			"id":"TLZdN",
			"index":0,
			"inputs":{
				"output":{
					"type":"object",
					"properties":{
						"openAiFormatMessages":{
							"type":"array",
							"items":{
								"type":"object",
								"properties":{
									"type":{
										"type":"string",
										"title":"Type"
									},
									"role":{
										"type":"string",
										"title":"Role"
									},
									"content":{
										"type":"array",
										"items":{
											"type":"object",
											"properties":{},
											"additionalProperties":false,
											"required":[]
										},
										"title":"Content"
									},
									"call_id":{
										"type":"string",
										"title":"Call Id"
									},
									"output":{
										"type":"string",
										"title":"Output"
									},
									"arguments":{
										"type":"string",
										"title":"Arguments"
									},
									"name":{
										"type":"string",
										"title":"Name"
									}
								},
								"additionalProperties":false,
								"required":[]
							},
							"title":"Open Ai Format Messages"
						},
						"lastFanMessage":{
							"type":"boolean",
							"title":"Last Fan Message"
						}
					},
					"additionalProperties":false,
					"required":[]
				},
				"input":{
					"type":"object",
					"properties":{
						"messages":{
							"type":"array",
							"items":{
								"type":"object",
								"properties":{},
								"additionalProperties":false
							},
							"title":"Messages"
						}
					},
					"additionalProperties":false,
					"required":[]
				},
				"compile_static":false,
				"code":"def openAiFormatMessages = []\ndef lastMessageRole = \"\"\n\nif (binding.hasVariable(\"messages\")) {\n  messages?.each { message -> \n    lastMessageRole = message?.role\n    message?.content?.forEach{ item ->\n      if(item?.type == 'text') {\n        openAiFormatMessages << [\n          \"type\": \"message\",\n          \"role\": message?.role,\n          \"content\": [[\n            \"type\": (message?.role == \"user\") ? \"input_text\" : \"text\",\n            \"text\":item?.text\n            ]]\n        ]\n      } else if (item?.type == 'tool_use') {\n        openAiFormatMessages << [\n          \"type\": \"function_call\",\n          \"call_id\": item?.id,\n          \"name\": item?.name,\n          \"arguments\": com.unifyapps.infra.utils.JsonUtils.toJson(item?.input)\n        ]\n      } else if (item?.type == 'tool_result') {\n        openAiFormatMessages << [\n          \"type\": \"function_call_output\",\n          \"call_id\": item?.tool_use_id,\n          \"output\": item?.content\n        ]\n      }\n    }\n  }\n}\n\nreturn [\n  \"openAiFormatMessages\": openAiFormatMessages,\n  \"lastFanMessage\": lastMessageRole == \"user\"\n  ]",
				"parameters":{
					"messages":{
						"ua:type":"mappedArray",
						"source":"{{ UZvws.outputs.messages }}",
						"items":"{{ UZvws.outputs.messages[0] }}"
					}
				}
			},
			"skip":false,
			"subTitle":"OpenAiFormatMessages",
			"title":"Execute Groovy code",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"loop",
				"resourceVersion":649,
				"resourceName":"loop_for_each",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"25VJv-1",
			"id":"dXQMw",
			"index":0,
			"inputs":{
				"repeatMode":"SINGLE",
				"listSource":"{{ TLZdN.outputs.result.openAiFormatMessages }}",
				"captureIterations":false
			},
			"skip":false,
			"subTitle":"Loop on messages",
			"title":"For loop",
			"type":"LOOP"
		},
		{
			"additional":{
				"visibleOptionalFields":[
					"root.item.content.items"
				]
			},
			"context":{
				"appName":"openai",
				"resourceVersion":99,
				"connectionId":"6803b3b6931eb527949e8fee",
				"resourceName":"openai_realtime_send_message",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"dXQMw@25VJv-1@l",
			"id":"F1Tvp",
			"index":0,
			"inputs":{
				"item":{
					"type":"{{ dXQMw.outputs.item.type }}",
					"role":"{{ dXQMw.outputs.item.role }}",
					"arguments":"{{ dXQMw.outputs.item.arguments }}",
					"call_id":"{{ dXQMw.outputs.item.call_id }}",
					"output":"{{ dXQMw.outputs.item.output }}",
					"name":"{{ dXQMw.outputs.item.name }}",
					"content":{
						"source":"{{ dXQMw.outputs.item.content }}",
						"ua:type":"mappedArray",
						"items":"{{ dXQMw.outputs.item.content[0] }}"
					}
				},
				"session_id":"{{ UZvws.outputs.session_id }}",
				"type":"conversation.item.create"
			},
			"skip":false,
			"subTitle":"Create message",
			"title":"Send Message to OpenAI Realtime",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"storage_by_unifyapps",
				"resourceVersion":2595,
				"resourceName":"storage_by_unifyapps_update_records",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"dXQMw@25VJv-1@l",
			"id":"HjYDq",
			"index":0,
			"inputs":{
				"numberOfRecordsToUpdate":"SINGLE",
				"triggerInputCondition":{
					"filters":[
						{
							"property":"id",
							"filter":{
								"operator":"EQUAL",
								"value":"{{ UZvws.outputs.session_id }}"
							}
						}
					],
					"operator":"AND"
				},
				"object_type":"testing_voicekit",
				"updateFields":[
					{
						"fieldName":"properties.events",
						"actionType":"ADD",
						"setValue":"addedToSession ->  {{ dXQMw.outputs.item.role }} : [{{ dXQMw.outputs.item.type }}] {{ dXQMw.outputs.item.content[0].text }}"
					}
				],
				"skipIfEmpty":false,
				"page":{
					"offset":0,
					"limit":20
				}
			},
			"skip":false,
			"subTitle":"Debug",
			"title":"Update records by query",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"if_else",
				"resourceVersion":590,
				"resourceName":"if_else_condition",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"25VJv-1",
			"id":"VR6NJ",
			"index":0,
			"inputs":{
				"filters":[
					{
						"property":"{{ TLZdN.outputs.result.lastFanMessage }}",
						"filter":{
							"operator":"EQUAL",
							"value":"true"
						}
					},
					{
						"property":"{{ UZvws.outputs.triggerResponse }}",
						"filter":{
							"operator":"EQUAL",
							"value":"true"
						}
					}
				],
				"operator":"AND"
			},
			"skip":false,
			"subTitle":"Last fan messsage?",
			"title":"Condition",
			"type":"IF_ELSE"
		},
		{
			"additional":{
				"visibleOptionalFields":[
					"root.item.content.text",
					"root.item.content.audio"
				]
			},
			"context":{
				"appName":"openai",
				"resourceVersion":95,
				"connectionId":"6803b3b6931eb527949e8fee",
				"resourceName":"openai_realtime_send_message",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"VR6NJ@25VJv-1@y",
			"id":"S8Ssg",
			"index":0,
			"inputs":{
				"session_id":"{{ UZvws.outputs.session_id }}",
				"type":"response.create"
			},
			"skip":false,
			"subTitle":"Generate Response",
			"title":"Send Message to OpenAI Realtime",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"storage_by_unifyapps",
				"resourceVersion":2595,
				"resourceName":"storage_by_unifyapps_update_records",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"VR6NJ@25VJv-1@y",
			"id":"oJiRq",
			"index":0,
			"inputs":{
				"numberOfRecordsToUpdate":"SINGLE",
				"triggerInputCondition":{
					"filters":[
						{
							"property":"id",
							"filter":{
								"operator":"EQUAL",
								"value":"{{ UZvws.outputs.session_id }}"
							}
						}
					],
					"operator":"AND"
				},
				"object_type":"testing_voicekit",
				"updateFields":[
					{
						"fieldName":"properties.events",
						"actionType":"ADD",
						"setValue":"[triggeredResponse]"
					}
				],
				"skipIfEmpty":false,
				"page":{
					"offset":0,
					"limit":20
				}
			},
			"skip":false,
			"subTitle":"Debug",
			"title":"Update records by query",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"callables",
				"resourceVersion":337,
				"resourceName":"callables_return_to_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"25VJv-1",
			"id":"EcX5Y",
			"index":0,
			"inputs":{
				"result":{
					"success":"true"
				}
			},
			"skip":false,
			"subTitle":"Callable",
			"title":"Respond to automation",
			"type":"STOP"
		}
	],
	"ownerUserId":-1,
	"runtimeConnectionAppNames":[
		"openai"
	],
	"schemaReferences":[
		
	],
	"settings":{
		"enableNodeLevelLogging":true,
		"enableRunLogging":true,
		"enableVariableLogging":true,
		"route":{
			"default":false,
			"headerValueTierMap":{},
			"tierName":"global"
		}
	},
	"standard":true,
	"tags":[
		
	],
	"version":72
}