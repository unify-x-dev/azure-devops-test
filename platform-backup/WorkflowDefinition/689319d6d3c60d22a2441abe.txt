{
	"appsUsed":[
		
	],
	"createdTime":1756795876043,
	"deleted":false,
	"deploymentState":{
		"deployedAt":1760296297991,
		"deployedBy":-1,
		"deployedDefinitionId":"68ebfd69d60dd816d7799121",
		"status":"DEPLOYED",
		"version":15,
		"workflowVersion":95
	},
	"edges":[
		{
			"fromNodeId":"n_iXkFJ",
			"priority":0,
			"skip":false,
			"toNodeId":"n_knqDF",
			"type":"next"
		},
		{
			"fromNodeId":"n_knqDF",
			"name":"1",
			"priority":0,
			"skip":false,
			"toNodeId":"n_knqDF@1",
			"type":"branch"
		},
		{
			"fromNodeId":"n_knqDF@1",
			"priority":0,
			"skip":false,
			"toNodeId":"n_d2TuW",
			"type":"next"
		},
		{
			"fromNodeId":"n_knqDF",
			"name":"2",
			"priority":0,
			"skip":false,
			"toNodeId":"n_knqDF@2",
			"type":"branch"
		},
		{
			"fromNodeId":"n_knqDF@2",
			"priority":0,
			"skip":false,
			"toNodeId":"n_Scvxm",
			"type":"next"
		},
		{
			"fromNodeId":"n_Scvxm",
			"priority":0,
			"skip":false,
			"toNodeId":"n_M5DVu",
			"type":"next"
		},
		{
			"fromNodeId":"n_M5DVu",
			"priority":0,
			"skip":false,
			"toNodeId":"_9wRyU",
			"type":"next"
		},
		{
			"fromNodeId":"n_knqDF",
			"name":"3",
			"priority":0,
			"skip":false,
			"toNodeId":"n_knqDF@3",
			"type":"branch"
		},
		{
			"fromNodeId":"n_knqDF@3",
			"priority":0,
			"skip":false,
			"toNodeId":"n_3RTHG",
			"type":"next"
		},
		{
			"fromNodeId":"n_3RTHG",
			"priority":0,
			"skip":false,
			"toNodeId":"n_tusj7",
			"type":"next"
		},
		{
			"fromNodeId":"n_tusj7",
			"priority":0,
			"skip":false,
			"toNodeId":"n_gko0B",
			"type":"next"
		},
		{
			"fromNodeId":"n_knqDF",
			"name":"4",
			"priority":0,
			"skip":false,
			"toNodeId":"n_knqDF@4",
			"type":"branch"
		},
		{
			"fromNodeId":"n_knqDF@4",
			"priority":0,
			"skip":false,
			"toNodeId":"n_nqJWd",
			"type":"next"
		},
		{
			"fromNodeId":"n_nqJWd",
			"priority":0,
			"skip":false,
			"toNodeId":"n_QH2q7",
			"type":"next"
		},
		{
			"fromNodeId":"n_QH2q7",
			"priority":0,
			"skip":false,
			"toNodeId":"n_TWsvj",
			"type":"next"
		},
		{
			"fromNodeId":"n_TWsvj",
			"priority":0,
			"skip":false,
			"toNodeId":"n_zknhU",
			"type":"next"
		},
		{
			"fromNodeId":"n_knqDF",
			"name":"5",
			"priority":0,
			"skip":false,
			"toNodeId":"n_knqDF@5",
			"type":"branch"
		},
		{
			"fromNodeId":"n_knqDF@5",
			"priority":0,
			"skip":false,
			"toNodeId":"n_iwfsF",
			"type":"next"
		},
		{
			"fromNodeId":"n_iwfsF",
			"priority":0,
			"skip":false,
			"toNodeId":"n_58B8c",
			"type":"next"
		},
		{
			"fromNodeId":"n_58B8c",
			"priority":0,
			"skip":false,
			"toNodeId":"n_rL2ny",
			"type":"next"
		},
		{
			"fromNodeId":"n_d2TuW",
			"priority":0,
			"skip":false,
			"toNodeId":"n_7ApTh",
			"type":"next"
		},
		{
			"fromNodeId":"_9wRyU",
			"priority":0,
			"skip":false,
			"toNodeId":"n_7ApTh",
			"type":"next"
		},
		{
			"fromNodeId":"n_gko0B",
			"priority":0,
			"skip":false,
			"toNodeId":"n_7ApTh",
			"type":"next"
		},
		{
			"fromNodeId":"n_zknhU",
			"priority":0,
			"skip":false,
			"toNodeId":"n_7ApTh",
			"type":"next"
		},
		{
			"fromNodeId":"n_rL2ny",
			"priority":0,
			"skip":false,
			"toNodeId":"n_7ApTh",
			"type":"next"
		},
		{
			"fromNodeId":"n_knqDF",
			"name":"default",
			"priority":0,
			"skip":false,
			"toNodeId":"n_7ApTh",
			"type":"branch"
		},
		{
			"fromNodeId":"n_7ApTh",
			"priority":0,
			"skip":false,
			"toNodeId":"n_043oo",
			"type":"next"
		}
	],
	"grants":{
		"configs":[
			{
				"permissions":[
					"V"
				],
				"principalType":"GLOBAL"
			}
		]
	},
	"id":"689319d6d3c60d22a2441abe",
	"lastModifiedBy":0,
	"lcName":"metering | models | metered usage, usage distribution and total requests",
	"modifiedTime":1761722850869,
	"name":"Metering | Models | Metered Usage, Usage distribution and Total requests",
	"nodes":[
		{
			"additional":{
				"xsdSchemaConfig":{
					"root":{}
				}
			},
			"context":{
				"appName":"callables",
				"resourceVersion":102,
				"resourceName":"callables_from_automation"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_vXQLK-1",
			"id":"n_iXkFJ",
			"index":1,
			"inputs":{
				"result":{
					"type":"object",
					"properties":{
						"meteringResult":{
							"type":"object",
							"properties":{},
							"additionalProperties":false,
							"title":"Metering Result"
						}
					},
					"additionalProperties":false,
					"required":[]
				},
				"setup":{
					"type":"object",
					"properties":{
						"startDate":{
							"type":"string",
							"title":"Start Date"
						},
						"endDate":{
							"type":"string",
							"title":"End Date"
						},
						"filter":{
							"type":"object",
							"properties":{},
							"additionalProperties":false,
							"title":"Filter"
						}
					},
					"additionalProperties":false,
					"required":[]
				}
			},
			"skip":false,
			"subTitle":"Callable",
			"title":"Trigger via automation",
			"trigger":{
				"type":"CALLABLE"
			},
			"type":"START"
		},
		{
			"context":{
				"appName":"branch",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_vXQLK-1",
			"id":"n_knqDF",
			"index":2,
			"inputs":{
				"branches":[
					{
						"id":"1",
						"inputs":{
							"name":"Active model "
						}
					},
					{
						"id":"2",
						"inputs":{
							"name":"Total number of requests"
						}
					},
					{
						"id":"3",
						"inputs":{
							"name":"Metered Usage and token usage"
						}
					},
					{
						"id":"4",
						"inputs":{
							"name":"model latency"
						}
					},
					{
						"id":"5",
						"inputs":{
							"name":"Use Case distribution"
						}
					},
					{
						"id":"default"
					}
				]
			},
			"skip":false,
			"subTitle":"Branch",
			"title":"",
			"type":"BRANCH"
		},
		{
			"context":{
				"appName":"branch_condition",
				"resourceVersion":0,
				"resourceName":"branch_condition",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"n_knqDF@_vXQLK-1@1",
			"id":"n_knqDF@1",
			"index":3,
			"inputs":{
				"name":"Active model "
			},
			"skip":false,
			"subTitle":"Active model ",
			"title":"",
			"type":"BRANCH_CONDITION"
		},
		{
			"context":{
				"appName":"analytics_by_unifyapps",
				"resourceVersion":456,
				"resourceName":"analytics_by_unifyapps_query_reports",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"n_knqDF@_vXQLK-1@1",
			"id":"n_d2TuW",
			"index":4,
			"inputs":{
				"projections":[
					{
						"name":"ENTITY_ai_agent_llm_model=::=ID",
						"aggregationFunction":"DISTINCT_COUNT",
						"alias":"totalModel",
						"includePercentageChange":false
					}
				],
				"filter":{
					"filters":[
						{
							"property":"ENTITY_ai_agent_llm_model=::=connectionId",
							"filter":{
								"operator":"EXISTS"
							}
						}
					],
					"operator":"AND"
				},
				"entityType":"ENTITY_ai_agent_llm_model",
				"group":"ENTITY_REPORTING"
			},
			"skip":false,
			"subTitle":"Analytics by UnifyApps",
			"title":"Analytics Query",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"branch_condition",
				"resourceVersion":0,
				"resourceName":"branch_condition",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"n_knqDF@_vXQLK-1@2",
			"id":"n_knqDF@2",
			"index":5,
			"inputs":{
				"name":"Total number of requests"
			},
			"skip":false,
			"subTitle":"Total number of requests",
			"title":"",
			"type":"BRANCH_CONDITION"
		},
		{
			"context":{
				"appName":"code_by_unifyapps",
				"resourceVersion":102,
				"resourceName":"code_by_unifyapps_groovy",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"n_knqDF@_vXQLK-1@2",
			"id":"n_Scvxm",
			"index":6,
			"inputs":{
				"output":{
					"type":"object",
					"properties":{
						"startEpoch":{
							"type":"integer",
							"title":"Start Epoch"
						},
						"endEpoch":{
							"type":"integer",
							"title":"End Epoch"
						}
					},
					"additionalProperties":false,
					"required":[
						"startEpoch",
						"endEpoch"
					]
				},
				"input":{
					"type":"object",
					"properties":{
						"startTime":{
							"type":"string",
							"title":"Start Time"
						},
						"endTime":{
							"type":"string",
							"title":"End Time"
						}
					},
					"additionalProperties":false,
					"required":[]
				},
				"compile_static":false,
				"code":"\nimport java.time.*\nimport java.time.format.DateTimeFormatter\ndef getEpochMillis(timestamp) {\n    if (!timestamp) return null\n    ZonedDateTime zdt = ZonedDateTime.parse(timestamp, DateTimeFormatter.ISO_DATE_TIME)\n    return zdt.toInstant().toEpochMilli()\n}\ndef getDefaultStartEndTimes() {\n    def now = ZonedDateTime.now(ZoneOffset.UTC)\n    def sevenDaysAgo = now.minusDays(7)\n    return [sevenDaysAgo.toInstant().toEpochMilli(), now.toInstant().toEpochMilli()]\n}\n\n\n// def prepareSQL(startTime, endTime) {\n//     return \"\"\"\n//         SELECT \n//             CAST(COUNT(*) AS INT) AS totalRequests, \n//             SUM(CAST(inputs -> 'inputTokens' AS INT)) + \n//             SUM(CAST(inputs -> 'outputTokens' AS INT)) AS totalTokenUsed, \n//             SUM(CAST(inputs -> 'totalCost' AS DOUBLE)) AS totalCost \n//         FROM \n//             WORKFLOW_NODE_EXECUTION \n//         WHERE  \n//             entryTime BETWEEN ${startTime} AND ${endTime}\n//             AND currentNodeId IN ('b66uk') \n//             AND workflowId IN ('66ac70650f725f5b425d12d8')\n//     \"\"\".stripIndent().trim()\n// }\n\ndef timestampStart = binding.hasVariable(\"startTime\") ? binding.startTime : null\ndef timestampEnd = binding.hasVariable(\"endTime\") ? binding.endTime : null\n\ndef startTime = getEpochMillis(timestampStart)\nif (startTime == null) startTime = getDefaultStartEndTimes().get(0)\n\ndef endTime = getEpochMillis(timestampEnd)\nif (endTime == null) endTime = getDefaultStartEndTimes().get(1)\n\nreturn [\"startEpoch\": startTime,\"endEpoch\":endTime]",
				"parameters":{
					"startTime":"{{ n_iXkFJ.outputs.startDate }}",
					"endTime":"{{ n_iXkFJ.outputs.endDate }}"
				}
			},
			"skip":false,
			"subTitle":"Prepare SQL",
			"title":"Execute Groovy code",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"analytics_by_unifyapps",
				"resourceVersion":103,
				"resourceName":"analytics_by_unifyapps_query_reports",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"n_knqDF@_vXQLK-1@2",
			"id":"n_M5DVu",
			"index":7,
			"inputs":{
				"projections":[
					{
						"name":"ENTITY_e_traces=::=ID",
						"aggregationFunction":"DISTINCT_COUNT",
						"alias":"totalRequests",
						"includePercentageChange":false
					},
					{
						"name":"ENTITY_e_traces=::=inputToken",
						"aggregationFunction":"SUM",
						"alias":"inputTokens",
						"includePercentageChange":false
					},
					{
						"name":"ENTITY_e_traces=::=outputToken",
						"aggregationFunction":"SUM",
						"alias":"outputTokens",
						"includePercentageChange":false
					},
					{
						"name":"ENTITY_e_traces=::=cost",
						"aggregationFunction":"SUM",
						"alias":"totalCost",
						"includePercentageChange":false
					}
				],
				"filter":{
					"filters":[
						{
							"property":"ENTITY_e_traces=::=toolName",
							"filter":{
								"operator":"MISSING"
							}
						},
						{
							"filters":[
								{
									"property":"ENTITY_e_traces=::=fromAutomationId",
									"filter":{
										"operator":"EQUAL",
										"value":"66ac70650f725f5b425d12d8"
									}
								},
								{
									"property":"ENTITY_e_traces=::=fromAutomationId",
									"filter":{
										"operator":"EQUAL",
										"value":"6851442f9e30586f552a6d73"
									}
								}
							],
							"operator":"OR"
						},
						{
							"property":"ENTITY_e_traces=::=llmErrorType",
							"filter":{
								"operator":"MISSING"
							}
						}
					],
					"operator":"AND"
				},
				"entityType":"ENTITY_e_traces",
				"page":{
					"offset":0,
					"limit":5000
				},
				"timeFilter":{
					"timeField":"ENTITY_e_traces=::=CREATED_TIME",
					"since":"{{ n_Scvxm.outputs.result.startEpoch }}",
					"until":"{{ n_Scvxm.outputs.result.endEpoch }}"
				},
				"group":"ENTITY_REPORTING"
			},
			"skip":false,
			"subTitle":"Analytics by UnifyApps",
			"title":"Analytics Query",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"analytics_by_unifyapps",
				"resourceVersion":103,
				"resourceName":"analytics_by_unifyapps_query_reports",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"n_knqDF@_vXQLK-1@2",
			"id":"_9wRyU",
			"index":8,
			"inputs":{
				"projections":[
					{
						"name":"ENTITY_e_traces=::=ID",
						"aggregationFunction":"DISTINCT_COUNT",
						"alias":"totalRequests",
						"includePercentageChange":false
					}
				],
				"filter":{
					"filters":[
						{
							"property":"ENTITY_e_traces=::=toolName",
							"filter":{
								"operator":"MISSING"
							}
						},
						{
							"filters":[
								{
									"property":"ENTITY_e_traces=::=fromAutomationId",
									"filter":{
										"operator":"EQUAL",
										"value":"66ac70650f725f5b425d12d8"
									}
								},
								{
									"property":"ENTITY_e_traces=::=fromAutomationId",
									"filter":{
										"operator":"EQUAL",
										"value":"6851442f9e30586f552a6d73"
									}
								}
							],
							"operator":"OR"
						}
					],
					"operator":"AND"
				},
				"entityType":"ENTITY_e_traces",
				"page":{
					"offset":0,
					"limit":5000
				},
				"timeFilter":{
					"timeField":"ENTITY_e_traces=::=CREATED_TIME",
					"since":"{{ n_Scvxm.outputs.result.startEpoch }}",
					"until":"{{ n_Scvxm.outputs.result.endEpoch }}"
				},
				"group":"ENTITY_REPORTING"
			},
			"skip":false,
			"subTitle":"Analytics by UnifyApps",
			"title":"Analytics Query",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"branch_condition",
				"resourceVersion":0,
				"resourceName":"branch_condition",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"n_knqDF@_vXQLK-1@3",
			"id":"n_knqDF@3",
			"index":9,
			"inputs":{
				"name":"Metered Usage and token usage"
			},
			"skip":false,
			"title":"",
			"type":"BRANCH_CONDITION"
		},
		{
			"context":{
				"appName":"code_by_unifyapps",
				"resourceVersion":102,
				"resourceName":"code_by_unifyapps_groovy",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"n_knqDF@_vXQLK-1@3",
			"id":"n_3RTHG",
			"index":10,
			"inputs":{
				"output":{
					"type":"object",
					"properties":{
						"startEpoch":{
							"type":"integer",
							"title":"Start Epoch"
						},
						"endEpoch":{
							"type":"integer",
							"title":"End Epoch"
						}
					},
					"additionalProperties":false,
					"required":[
						"startEpoch",
						"endEpoch"
					]
				},
				"input":{
					"type":"object",
					"properties":{
						"startDate":{
							"type":"string",
							"title":"Start Date"
						},
						"endDate":{
							"type":"string",
							"title":"End Date"
						}
					},
					"additionalProperties":false,
					"required":[]
				},
				"compile_static":false,
				"code":"\nimport java.time.*\nimport java.time.format.DateTimeFormatter\n\ndef getEpochMillis(String timestamp) {\n    if (!timestamp) return null\n    return ZonedDateTime.parse(timestamp, DateTimeFormatter.ISO_DATE_TIME).toInstant().toEpochMilli()\n}\n\ndef getDefaultStartEndTimes() {\n    def now = ZonedDateTime.now(ZoneOffset.UTC)\n    def sevenDaysAgo = now.minusDays(7)\n    return [sevenDaysAgo.toInstant().toEpochMilli(), now.toInstant().toEpochMilli()]\n}\n\n// def prepareSQL(long startMillis, long endMillis) {\n//     return \"\"\"\n//     SELECT \n//         DATE(FROM_UNIXTIME(createdTime / 1000)) AS date,\n//         SUM(CAST(_pr_inputToken AS INT)) AS inputTokens,\n//         SUM(CAST(_pr_outputToken AS INT)) AS outputTokens,\n//         SUM(CAST( _pr_inputToken AS INT)) + \n//         SUM(CAST(_pr_outputToken AS INT)) AS totalTokenUsed,\n//         SUM(CAST(_pr_cost AS DOUBLE)) AS totalCost\n//     FROM \n//         ENTITY_e_traces\n//     WHERE \n//         createdTime BETWEEN ${startMillis} AND ${endMillis}\n//         AND _pr_toolName IS NULL\n//     GROUP BY \n//         DATE(FROM_UNIXTIME(createdTime / 1000))\n//     ORDER BY \n//         date ASC\n//     \"\"\".stripIndent().trim()\n// }\n\ndef timestampStart=binding.hasVariable(\"startDate\")?startDate:null\ndef timestampEnd=binding.hasVariable(\"endDate\")?endDate:null\n\ndef startTime = getEpochMillis(timestampStart)\ndef endTime = getEpochMillis(timestampEnd)\n\nif (startTime == null || endTime == null) {\n    def (defaultStart, defaultEnd) = getDefaultStartEndTimes()\n    startTime =  defaultStart\n    endTime = defaultEnd\n}\nreturn [\"startEpoch\": startTime,\"endEpoch\":endTime]",
				"parameters":{
					"startDate":"{{ n_iXkFJ.outputs.startDate }}",
					"endDate":"{{ n_iXkFJ.outputs.endDate }}"
				}
			},
			"skip":false,
			"subTitle":"Code by UnifyApps",
			"title":"Execute Groovy code",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"analytics_by_unifyapps",
				"resourceVersion":104,
				"resourceName":"analytics_by_unifyapps_query_reports",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"n_knqDF@_vXQLK-1@3",
			"id":"n_tusj7",
			"index":11,
			"inputs":{
				"projections":[
					{
						"name":"ENTITY_e_traces=::=CREATED_TIME",
						"aggregationFunction":"HISTOGRAM",
						"alias":"date",
						"includePercentageChange":false,
						"intervals":[
							{
								"interval":"DAY",
								"groupBy":"DAY"
							},
							{
								"interval":"WEEK",
								"groupBy":"DAY"
							},
							{
								"interval":"MONTH",
								"groupBy":"DAY"
							},
							{
								"interval":"YEAR",
								"groupBy":"DAY"
							}
						]
					},
					{
						"name":"ENTITY_e_traces=::=inputToken",
						"aggregationFunction":"SUM",
						"alias":"inputTokens",
						"includePercentageChange":false
					},
					{
						"name":"ENTITY_e_traces=::=outputToken",
						"aggregationFunction":"SUM",
						"alias":"outputTokens",
						"includePercentageChange":false
					},
					{
						"name":"inputTokens+outputTokens",
						"aggregationFunction":"CUSTOM",
						"alias":"totalTokens",
						"includePercentageChange":false
					},
					{
						"name":"ENTITY_e_traces=::=cost",
						"aggregationFunction":"SUM",
						"alias":"totalCost",
						"includePercentageChange":false
					}
				],
				"filter":{
					"filters":[
						{
							"property":"ENTITY_e_traces=::=toolName",
							"filter":{
								"operator":"MISSING"
							}
						},
						{
							"filters":[
								{
									"property":"ENTITY_e_traces=::=fromAutomationId",
									"filter":{
										"operator":"EQUAL",
										"value":"66ac70650f725f5b425d12d8"
									}
								},
								{
									"property":"ENTITY_e_traces=::=fromAutomationId",
									"filter":{
										"operator":"EQUAL",
										"value":"6851442f9e30586f552a6d73"
									}
								}
							],
							"operator":"OR"
						},
						{
							"property":"ENTITY_e_traces=::=llmErrorType",
							"filter":{
								"operator":"MISSING"
							}
						}
					],
					"operator":"AND"
				},
				"entityType":"ENTITY_e_traces",
				"sorts":[
					{
						"field":"date",
						"order":"ASC"
					}
				],
				"timeFilter":{
					"since":"{{ n_3RTHG.outputs.result.startEpoch }}",
					"until":"{{ n_3RTHG.outputs.result.endEpoch }}"
				},
				"group":"ENTITY_REPORTING"
			},
			"skip":false,
			"subTitle":"Analytics by UnifyApps",
			"title":"Analytics Query",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"analytics_by_unifyapps",
				"resourceVersion":104,
				"resourceName":"analytics_by_unifyapps_execute_query",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"n_knqDF@_vXQLK-1@3",
			"id":"n_gko0B",
			"index":12,
			"inputs":{
				"outputSchema":{
					"type":"object",
					"properties":{
						"columns":{
							"type":"object",
							"properties":{
								"inputTokens":{
									"type":"integer",
									"title":"Input Tokens"
								},
								"totalCost":{
									"type":"number",
									"title":"Total Cost"
								},
								"outputTokens":{
									"type":"integer",
									"title":"Output Tokens"
								},
								"totalTokenUsed":{
									"type":"integer",
									"title":"Total Token Used"
								},
								"date":{
									"type":"string",
									"title":"Date"
								}
							},
							"additionalProperties":false,
							"title":"Columns",
							"required":[]
						}
					},
					"additionalProperties":false,
					"required":[]
				},
				"query":"{{ n_3RTHG.outputs.result.sqlQuery }}",
				"group":"ENTITY_REPORTING"
			},
			"options":{
				"bulkheadConfig":{
					"enabled":false,
					"maxLeaseTimeUnit":"SECONDS",
					"maxWaitDurationUnit":"SECONDS"
				},
				"businessHoursConfig":{
					"enabled":false,
					"waitForNextWindow":false
				},
				"cacheConfig":{
					"cacheKey":"689319d6d3c60d22a2441abe_widget_1",
					"enabled":false,
					"timeToLive":"7200",
					"usagePolicy":"ALWAYS"
				},
				"circuitBreakerConfig":{
					"enabled":false,
					"slidingWindowType":"COUNT_BASED"
				},
				"disableLogging":false,
				"enabledForReExecution":false,
				"hookConfig":{
					"enabled":false,
					"postHooks":[
						
					],
					"preHooks":[
						
					]
				},
				"logConfig":{
					"enabled":false,
					"logPolicies":[
						
					]
				},
				"rateLimitConfig":{
					"enabled":false,
					"unit":"MINUTES",
					"waitForNextWindow":false
				},
				"retryConfig":{
					"backOffFactor":null,
					"captureRetries":false,
					"enabled":false
				},
				"stepError":"STOP",
				"telemetryConfig":{
					"enableTelemetry":false,
					"metricConfigs":[
						
					]
				}
			},
			"skip":true,
			"subTitle":"Analytics by UnifyApps",
			"title":"Execute Analytics SQL Query",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"branch_condition",
				"resourceVersion":0,
				"resourceName":"branch_condition",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"n_knqDF@_vXQLK-1@4",
			"id":"n_knqDF@4",
			"index":13,
			"inputs":{
				"name":"model latency"
			},
			"skip":true,
			"title":"",
			"type":"BRANCH_CONDITION"
		},
		{
			"context":{
				"appName":"code_by_unifyapps",
				"resourceVersion":102,
				"resourceName":"code_by_unifyapps_groovy",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"n_knqDF@_vXQLK-1@4",
			"id":"n_nqJWd",
			"index":14,
			"inputs":{
				"output":{
					"type":"object",
					"properties":{
						"sqlQuery":{
							"type":"string",
							"title":"Sql Query"
						}
					},
					"additionalProperties":false,
					"required":[]
				},
				"input":{
					"type":"object",
					"properties":{
						"startDate":{
							"type":"string",
							"title":"Start Date"
						},
						"endDate":{
							"type":"string",
							"title":"End Date"
						}
					},
					"additionalProperties":false,
					"required":[]
				},
				"compile_static":false,
				"code":"\nimport java.time.*\nimport java.time.format.DateTimeFormatter\n\ndef getEpochMillis(String timestamp) {\n    if (!timestamp) return null\n    return ZonedDateTime.parse(timestamp, DateTimeFormatter.ISO_DATE_TIME).toInstant().toEpochMilli()\n}\n\ndef getDefaultStartEndTimes() {\n    def now = ZonedDateTime.now(ZoneOffset.UTC)\n    def sevenDaysAgo = now.minusDays(7)\n    return [sevenDaysAgo.toInstant().toEpochMilli(), now.toInstant().toEpochMilli()]\n}\ndef timestampStart=binding.hasVariable(\"startDate\")?startDate:null\ndef timestampEnd=binding.hasVariable(\"endDate\")?endDate:null\n\ndef startMillis = getEpochMillis(timestampStart)\ndef endMillis = getEpochMillis(timestampEnd)\n\nif (startMillis == null || endMillis == null) {\n    def (defaultStart, defaultEnd) = getDefaultStartEndTimes()\n    startMillis =  defaultStart\n    endMillis = defaultEnd\n}\n\ndef prepareSQL(startMillis,endMillis)\n{\n    return \"SELECT CAST(GET_JSON_STRING(inputs , 'modelName') AS STRING) AS model, COUNT(*) AS requestCount FROM WORKFLOW_NODE_EXECUTION WHERE entryTime BETWEEN ${startMillis} AND ${endMillis} AND currentNodeId IN ('b66uk') AND workflowId IN ('66ac70650f725f5b425d12d8') GROUP BY model ORDER BY requestCount DESC LIMIT 5\".toString()\n}\nreturn [\"sqlQuery\":prepareSQL(startMillis,endMillis)]",
				"parameters":{
					"startDate":"{{ n_iXkFJ.outputs.startDate }}",
					"endDate":"{{ n_iXkFJ.outputs.endDate }}"
				}
			},
			"skip":true,
			"subTitle":"Prepare sql to fetch top 5 trending models",
			"title":"Execute Groovy code",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"analytics_by_unifyapps",
				"resourceVersion":103,
				"resourceName":"analytics_by_unifyapps_execute_query",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"n_knqDF@_vXQLK-1@4",
			"id":"n_QH2q7",
			"index":15,
			"inputs":{
				"outputSchema":{
					"type":"object",
					"properties":{
						"columns":{
							"type":"object",
							"properties":{
								"model":{
									"type":"string",
									"title":"Model"
								}
							},
							"additionalProperties":false,
							"title":"Columns",
							"required":[]
						}
					},
					"additionalProperties":false,
					"required":[]
				},
				"query":"{{ n_nqJWd.outputs.result.sqlQuery }}",
				"group":"PLATFORM"
			},
			"skip":true,
			"subTitle":"Analytics by UnifyApps",
			"title":"Execute Analytics SQL Query",
			"type":"ACTION"
		},
		{
			"additional":{
				"visibleOptionalFields":[
					"root.parameters.modelList.items"
				]
			},
			"context":{
				"appName":"code_by_unifyapps",
				"resourceVersion":102,
				"resourceName":"code_by_unifyapps_groovy",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"n_knqDF@_vXQLK-1@4",
			"id":"n_TWsvj",
			"index":16,
			"inputs":{
				"output":{
					"type":"object",
					"properties":{
						"sqlQuery":{
							"type":"string",
							"title":"Sql Query"
						}
					},
					"additionalProperties":false,
					"required":[]
				},
				"input":{
					"type":"object",
					"properties":{
						"modelList":{
							"type":"array",
							"items":{
								"type":"string"
							},
							"title":"Model List"
						},
						"startDate":{
							"type":"string",
							"title":"Start Date"
						},
						"endDate":{
							"type":"string",
							"title":"End Date"
						}
					},
					"additionalProperties":false,
					"required":[]
				},
				"compile_static":false,
				"code":"import java.time.*\nimport java.time.format.DateTimeFormatter\n\ndef getEpochMillis(String timestamp) {\n    if (!timestamp) return null\n    return ZonedDateTime.parse(timestamp, DateTimeFormatter.ISO_DATE_TIME).toInstant().toEpochMilli()\n}\n\ndef getDefaultStartEndTimes() {\n    def now = ZonedDateTime.now(ZoneOffset.UTC)\n    def sevenDaysAgo = now.minusDays(7)\n    return [sevenDaysAgo.toInstant().toEpochMilli(), now.toInstant().toEpochMilli()]\n}\ndef timestampStart=binding.hasVariable(\"startDate\")?startDate:null\ndef timestampEnd=binding.hasVariable(\"endDate\")?endDate:null\n\ndef modelList=binding.hasVariable(\"modelList\")?modelList:null\ndef models = modelList.collect { \"'${it}'\" }.join(\", \")\n\ndef startMillis = getEpochMillis(timestampStart)\ndef endMillis = getEpochMillis(timestampEnd)\n\nif (startMillis == null || endMillis == null) {\n    def (defaultStart, defaultEnd) = getDefaultStartEndTimes()\n    startMillis =  defaultStart\n    endMillis = defaultEnd\n}\ndef prepareSql(startMillis,endMillis,models)\n{\n    return \"\"\"\n    SELECT \n        GET_JSON_STRING(inputs, 'modelName') AS model,\n        DATE(FROM_UNIXTIME(entryTime / 1000)) AS date,\n        AVG(GET_JSON_DOUBLE(outputs, '\\$.result.timeTaken')) AS avgLatency\n    FROM \n        WORKFLOW_NODE_EXECUTION\n    WHERE \n        entryTime BETWEEN ${startMillis} AND ${endMillis}\n        AND GET_JSON_STRING(inputs, 'modelName') IN (${models})\n        AND currentNodeId IN ('b66uk') \n        AND workflowId IN ('66ac70650f725f5b425d12d8')\n    GROUP BY \n        model, DATE(FROM_UNIXTIME(entryTime / 1000))\n    ORDER BY \n        date ASC;\n    \"\"\".stripIndent().trim()\n}\nreturn [\"sqlQuery\":prepareSql(startMillis,endMillis,models)]",
				"parameters":{
					"modelList":{
						"source":"{{ n_QH2q7.outputs.objects }}",
						"ua:type":"mappedArray",
						"items":"{{ n_QH2q7.outputs.objects[0].columns.model }}"
					},
					"startDate":"{{ n_iXkFJ.outputs.startDate }}",
					"endDate":"{{ n_iXkFJ.outputs.endDate }}"
				}
			},
			"skip":true,
			"subTitle":"Code by UnifyApps",
			"title":"Execute Groovy code",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"analytics_by_unifyapps",
				"resourceVersion":103,
				"resourceName":"analytics_by_unifyapps_execute_query",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"n_knqDF@_vXQLK-1@4",
			"id":"n_zknhU",
			"index":17,
			"inputs":{
				"outputSchema":{
					"type":"object",
					"properties":{
						"columns":{
							"type":"object",
							"properties":{
								"model":{
									"type":"string",
									"title":"Model"
								},
								"avgLatency":{
									"type":"string",
									"title":"Avg Latency"
								},
								"date":{
									"type":"string",
									"title":"Date"
								}
							},
							"additionalProperties":false,
							"title":"Columns",
							"required":[]
						}
					},
					"additionalProperties":false,
					"required":[]
				},
				"query":"{{ n_TWsvj.outputs.result.sqlQuery }}",
				"group":"PLATFORM"
			},
			"skip":true,
			"subTitle":"Analytics by UnifyApps",
			"title":"Execute Analytics SQL Query",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"branch_condition",
				"resourceVersion":0,
				"resourceName":"branch_condition",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"n_knqDF@_vXQLK-1@5",
			"id":"n_knqDF@5",
			"index":18,
			"inputs":{
				"name":"Use Case distribution"
			},
			"skip":false,
			"title":"",
			"type":"BRANCH_CONDITION"
		},
		{
			"context":{
				"appName":"code_by_unifyapps",
				"resourceVersion":451,
				"resourceName":"code_by_unifyapps_groovy",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"n_knqDF@_vXQLK-1@5",
			"id":"n_iwfsF",
			"index":19,
			"inputs":{
				"output":{
					"type":"object",
					"additionalProperties":false,
					"required":[],
					"properties":{
						"sqlQuery":{
							"type":"string",
							"title":"Sql Query"
						}
					}
				},
				"input":{
					"type":"object",
					"additionalProperties":false,
					"required":[],
					"properties":{
						"startDate":{
							"type":"string",
							"title":"Start Date"
						},
						"endDate":{
							"type":"string",
							"title":"End Date"
						}
					}
				},
				"code":"\nimport java.time.*\nimport java.time.format.DateTimeFormatter\n\ndef getEpochMillis(String timestamp) {\n    if (!timestamp) return null\n    return ZonedDateTime.parse(timestamp, DateTimeFormatter.ISO_DATE_TIME).toInstant().toEpochMilli()\n}\n\ndef getDefaultStartEndTimes() {\n    def now = ZonedDateTime.now(ZoneOffset.UTC)\n    def sevenDaysAgo = now.minusDays(7)\n    return [sevenDaysAgo.toInstant().toEpochMilli(), now.toInstant().toEpochMilli()]\n}\ndef timestampStart=binding.hasVariable(\"startDate\")?startDate:null\ndef timestampEnd=binding.hasVariable(\"endDate\")?endDate:null\n\ndef startMillis = getEpochMillis(timestampStart)\ndef endMillis = getEpochMillis(timestampEnd)\n\nif (startMillis == null || endMillis == null) {\n    def (defaultStart, defaultEnd) = getDefaultStartEndTimes()\n    startMillis =  defaultStart\n    endMillis = defaultEnd\n}\n\ndef prepareSQL(startMillis,endMillis)\n{\n    return \"SELECT CAST(_pr_parent AS STRING) AS step, COUNT(*) AS requestCount FROM ENTITY_e_traces WHERE createdTime BETWEEN ${startMillis} AND ${endMillis} AND _pr_toolName is NULL AND _pr_parent IS NOT NULL AND (_pr_fromAutomationId='6851442f9e30586f552a6d73' OR _pr_fromAutomationId='66ac70650f725f5b425d12d8') AND _pr_llmErrorType IS NULL GROUP BY step\".toString()\n}\nreturn [\"sqlQuery\":prepareSQL(startMillis,endMillis)]",
				"compile_static":false,
				"parameters":{
					"startDate":"{{ n_iXkFJ.outputs.startDate }}",
					"endDate":"{{ n_iXkFJ.outputs.endDate }}"
				}
			},
			"skip":false,
			"subTitle":"Code by UnifyApps",
			"title":"Execute Groovy code",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"analytics_by_unifyapps",
				"resourceVersion":0,
				"resourceName":"analytics_by_unifyapps_execute_query",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"n_knqDF@_vXQLK-1@5",
			"id":"n_58B8c",
			"index":20,
			"inputs":{
				"outputSchema":{
					"type":"object",
					"properties":{
						"columns":{
							"type":"object",
							"properties":{
								"requestCount":{
									"type":"integer",
									"title":"Request Count"
								},
								"step":{
									"type":"string",
									"title":"Step"
								}
							},
							"additionalProperties":false,
							"title":"Columns",
							"required":[]
						}
					},
					"additionalProperties":false,
					"required":[]
				},
				"query":"{{ n_iwfsF.outputs.result.sqlQuery }}",
				"group":"ENTITY_REPORTING"
			},
			"options":{
				"bulkheadConfig":{
					"enabled":false,
					"maxLeaseTimeUnit":"SECONDS",
					"maxWaitDurationUnit":"SECONDS"
				},
				"businessHoursConfig":{
					"enabled":false,
					"waitForNextWindow":false
				},
				"cacheConfig":{
					"cacheKey":"689319d6d3c60d22a2441abe_me_db3",
					"enabled":false,
					"timeToLive":"7200",
					"usagePolicy":"ALWAYS"
				},
				"circuitBreakerConfig":{
					"enabled":false,
					"slidingWindowType":"COUNT_BASED"
				},
				"disableLogging":false,
				"enabledForReExecution":false,
				"hookConfig":{
					"enabled":false,
					"postHooks":[
						
					],
					"preHooks":[
						
					]
				},
				"logConfig":{
					"enabled":false,
					"logPolicies":[
						
					]
				},
				"rateLimitConfig":{
					"enabled":false,
					"unit":"MINUTES",
					"waitForNextWindow":false
				},
				"retryConfig":{
					"backOffFactor":null,
					"captureRetries":false,
					"enabled":false
				},
				"stepError":"STOP",
				"telemetryConfig":{
					"enableTelemetry":false,
					"metricConfigs":[
						
					]
				}
			},
			"skip":false,
			"subTitle":"Analytics by UnifyApps",
			"title":"Execute Analytics SQL Query",
			"type":"ACTION"
		},
		{
			"additional":{
				"visibleOptionalFields":[
					"root.parameters.useCaseList.items"
				]
			},
			"context":{
				"appName":"code_by_unifyapps",
				"resourceVersion":451,
				"resourceName":"code_by_unifyapps_groovy",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"n_knqDF@_vXQLK-1@5",
			"id":"n_rL2ny",
			"index":21,
			"inputs":{
				"output":{
					"type":"object",
					"additionalProperties":false,
					"required":[],
					"properties":{
						"stepCounts":{
							"type":"array",
							"items":{
								"type":"object",
								"properties":{
									"title":{
										"type":"string",
										"title":"Title"
									},
									"count":{
										"type":"integer",
										"title":"Count"
									}
								},
								"additionalProperties":false,
								"required":[]
							},
							"title":"Step Counts"
						},
						"totalCounts":{
							"type":"string",
							"title":"Total Counts"
						}
					}
				},
				"input":{
					"type":"object",
					"additionalProperties":false,
					"required":[],
					"properties":{
						"useCaseList":{
							"type":"array",
							"items":{
								"type":"object",
								"properties":{},
								"additionalProperties":false
							},
							"title":"Use Case List"
						}
					}
				},
				"code":"def idVsTitle = [\n    \"Re-phraser\"      : \"Query Rephrasing\",\n    \"Guardrail\"       : \"Guardrail\",\n    \"Embeddings\"      : \"Embeddings\",\n    \"Agent Execution\" : \"Task Execution\"\n]\n\ndef useCaseList = binding.hasVariable(\"useCaseList\") ? binding.useCaseList : []\ndef stepCounts = [:].withDefault { 0 }\n\nuseCaseList.each { useCase ->\n    def step = useCase.step\n    if (step && idVsTitle.containsKey(step)) {\n        stepCounts[step] += useCase.requestCount\n    } else {\n        stepCounts[\"Others\"] += useCase.requestCount  // Changed to \"Others\"\n    }\n}\n\ndef totalCounts = 0\nstepCounts.each { k, v ->\n    totalCounts += v\n}\n\ndef response = stepCounts.collect { key, count ->\n    [\n        step : key,\n        title: idVsTitle.get(key, \"Others\"),  // Changed to \"Others\"\n        count: count\n    ]\n}.sort { a, b -> \n    // Put \"Others\" at the end, sort rest by count descending\n    if (a.step == \"Others\") return 1\n    if (b.step == \"Others\") return -1\n    return b.count <=> a.count\n}\n\nreturn [\"stepCounts\": response, \"totalCounts\": totalCounts]",
				"compile_static":false,
				"parameters":{
					"useCaseList":{
						"source":"{{ n_58B8c.outputs.objects }}",
						"ua:type":"mappedArray",
						"items":"{{ n_58B8c.outputs.objects[0].columns }}"
					}
				}
			},
			"skip":false,
			"subTitle":"Enrich Title",
			"title":"Execute Groovy code",
			"type":"ACTION"
		},
		{
			"additional":{
				"visibleOptionalFields":[
					"root.parameters.meteredUsage.items.date",
					"root.parameters.meteredUsage.items.totalCost",
					"root.parameters.tokenUsage.items.date",
					"root.parameters.tokenUsage.items.inputTokens",
					"root.parameters.tokenUsage.items.outputTokens",
					"root.parameters.tokenUsage.items.totalTokens",
					"root.parameters.useCaseResponse.items"
				]
			},
			"context":{
				"appName":"code_by_unifyapps",
				"resourceVersion":102,
				"resourceName":"code_by_unifyapps_groovy",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_vXQLK-1",
			"id":"n_7ApTh",
			"index":22,
			"inputs":{
				"output":{
					"type":"object",
					"additionalProperties":false,
					"required":[],
					"properties":{
						"meteringResult":{
							"type":"object",
							"properties":{
								"tokenUsage":{
									"type":"array",
									"items":{
										"type":"object",
										"properties":{
											"date":{
												"type":"string",
												"title":"Date"
											},
											"inputTokens":{
												"type":"string",
												"title":"Input Tokens"
											},
											"outputTokens":{
												"type":"string",
												"title":"Output Tokens"
											},
											"totalTokens":{
												"type":"string",
												"title":"Total Tokens"
											}
										},
										"additionalProperties":false,
										"required":[]
									},
									"title":"Token Usage"
								},
								"meteredUsage":{
									"type":"array",
									"items":{
										"type":"object",
										"properties":{
											"date":{
												"type":"string",
												"title":"Date"
											},
											"totalCost":{
												"type":"number",
												"title":"Total Cost"
											}
										},
										"additionalProperties":false,
										"required":[]
									},
									"title":"Metered Usage"
								},
								"LLMCount":{
									"type":"integer",
									"title":"LLM Count"
								},
								"totalRequests":{
									"type":"integer",
									"title":"Total Requests"
								},
								"totalTokenUsed":{
									"type":"number",
									"title":"Total Token Used"
								},
								"totalCost":{
									"type":"number",
									"title":"Total Cost"
								},
								"useCaseResponse":{
									"type":"array",
									"items":{
										"type":"object",
										"properties":{
											"title":{
												"type":"string",
												"title":"Title"
											},
											"count":{
												"type":"integer",
												"title":"Count"
											}
										},
										"additionalProperties":false,
										"required":[]
									},
									"title":"Use Case Response"
								},
								"totalUseCaseCount":{
									"type":"integer",
									"title":"Total Use Case Count"
								}
							},
							"additionalProperties":false,
							"title":"Metering Result",
							"required":[]
						}
					}
				},
				"input":{
					"type":"object",
					"additionalProperties":false,
					"required":[],
					"properties":{
						"LLMCount":{
							"type":"integer",
							"title":"LLM Count"
						},
						"totalRequests":{
							"type":"integer",
							"title":"Total Requests"
						},
						"totalTokenUsed":{
							"type":"integer",
							"title":"Total Token Used"
						},
						"totalCost":{
							"type":"number",
							"title":"Total Cost"
						},
						"meteredUsage":{
							"type":"array",
							"items":{
								"type":"object",
								"properties":{
									"date":{
										"type":"string",
										"title":"Date"
									},
									"totalCost":{
										"type":"number",
										"title":"Total Cost"
									}
								},
								"additionalProperties":false,
								"required":[]
							},
							"title":"Metered Usage"
						},
						"tokenUsage":{
							"type":"array",
							"items":{
								"type":"object",
								"properties":{
									"date":{
										"type":"string",
										"title":"Date"
									},
									"inputTokens":{
										"type":"string",
										"title":"Input Tokens"
									},
									"outputTokens":{
										"type":"string",
										"title":"Output Tokens"
									},
									"totalTokens":{
										"type":"string",
										"title":"Total Tokens"
									}
								},
								"additionalProperties":false,
								"required":[]
							},
							"title":"Token Usage"
						},
						"useCaseResponse":{
							"type":"array",
							"items":{
								"type":"object",
								"properties":{},
								"additionalProperties":false
							},
							"title":"Use Case Response"
						},
						"totalUseCaseCount":{
							"type":"integer",
							"title":"Total Use Case Count"
						}
					}
				},
				"code":"import java.time.LocalDate\nimport java.time.format.DateTimeFormatter\nimport java.time.DayOfWeek\n\ndef LLMCount=binding.hasVariable(\"LLMCount\")?LLMCount:0\ndef totalRequests=binding.hasVariable(\"totalRequests\")?totalRequests:0\ndef totalTokenUsed=binding.hasVariable(\"totalTokenUsed\")?totalTokenUsed:0\ndef totalCost=binding.hasVariable(\"totalCost\")?totalCost:0\ndef meteredUsage=binding.hasVariable(\"meteredUsage\")?meteredUsage:[]\ndef tokenUsage=binding.hasVariable(\"tokenUsage\")?tokenUsage:[]\ndef useCaseResponse=binding.hasVariable(\"useCaseResponse\")?useCaseResponse:[]\ndef totalUseCaseCount=binding.hasVariable(\"totalUseCaseCount\")?totalUseCaseCount:0\ndef totalTokenForTokenUsage=0\ndef meteringResult=[:]\n\ndef cumulativeCost=0\nmeteredUsage.each{ ele->\n\n  cumulativeCost+=ele?.totalCost?:0\n  ele << [\"cumulativeCost\":cumulativeCost]\n}\n\ndef cumulativeToken=0\ntokenUsage.each{ ele->\n  totalTokenForTokenUsage+=(ele.totalTokens ?: 0) as Integer\n  ele << [\"cumulativeToken\":totalTokenForTokenUsage]\n}\n\n\n\nmeteringResult << [\"tokenUsage\":tokenUsage]\nmeteringResult << [\"meteredUsage\":meteredUsage]\nmeteringResult << [\"LLMCount\":LLMCount]\nmeteringResult << [\"totalRequests\":totalRequests]\nmeteringResult << [\"totalTokenUsed\":totalTokenUsed]\nmeteringResult << [\"totalCost\":totalCost]\nmeteringResult << [\"useCaseResponse\":useCaseResponse]\nmeteringResult << [\"totalUseCaseCount\":totalUseCaseCount]\nmeteringResult << [\"totalTokenForTokenUsage\":totalTokenForTokenUsage]\nreturn [\"meteringResult\":meteringResult]\n ",
				"compile_static":false,
				"captureStdOutput":false,
				"parameters":{
					"LLMCount":"{{ n_d2TuW.outputs.objects[0].columns.totalModel }}",
					"totalRequests":"{{ _9wRyU.outputs.objects[0].columns.totalRequests }}",
					"totalTokenUsed":"=SUM({{ n_M5DVu.outputs.objects[0].columns.inputTokens }},{{ n_M5DVu.outputs.objects[0].columns.outputTokens }})",
					"totalCost":"{{ n_M5DVu.outputs.objects[0].columns.totalCost }}",
					"totalUseCaseCount":"{{ n_rL2ny.outputs.result.totalCounts }}",
					"tokenUsage":{
						"ua:type":"mappedArray",
						"items":{
							"date":"{{ n_tusj7.outputs.objects[0].columns.date }}",
							"inputTokens":"{{ n_tusj7.outputs.objects[0].columns.inputTokens }}",
							"outputTokens":"{{ n_tusj7.outputs.objects[0].columns.outputTokens }}",
							"totalTokens":"{{ n_tusj7.outputs.objects[0].columns.totalTokens }}"
						},
						"source":"{{ n_tusj7.outputs.objects }}"
					},
					"meteredUsage":{
						"items":{
							"date":"{{ n_tusj7.outputs.objects[0].columns.date }}",
							"totalCost":"{{ n_tusj7.outputs.objects[0].columns.totalCost }}"
						},
						"ua:type":"mappedArray",
						"source":"{{ n_tusj7.outputs.objects }}"
					},
					"useCaseResponse":{
						"source":"{{ n_rL2ny.outputs.result.stepCounts }}",
						"ua:type":"mappedArray",
						"items":"{{ n_rL2ny.outputs.result.stepCounts[0] }}"
					}
				}
			},
			"skip":false,
			"subTitle":"Combine result",
			"title":"Execute Groovy code",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"callables",
				"resourceVersion":103,
				"resourceName":"callables_return_to_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_vXQLK-1",
			"id":"n_043oo",
			"index":23,
			"inputs":{
				"result":{
					"meteringResult":"{{ n_7ApTh.outputs.result.meteringResult }}"
				}
			},
			"skip":false,
			"subTitle":"Callable",
			"title":"Respond to automation",
			"type":"STOP"
		}
	],
	"ownerUserId":33860,
	"schemaReferences":[
		
	],
	"settings":{
		"enableNodeLevelLogging":true,
		"enableRunLogging":true,
		"enableVariableLogging":true,
		"route":{
			"default":false,
			"tierName":"global"
		}
	},
	"standard":true,
	"tags":[
		
	],
	"version":97
}