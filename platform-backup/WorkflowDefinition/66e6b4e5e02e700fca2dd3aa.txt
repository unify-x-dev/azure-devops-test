{
	"appsUsed":[
		"openai",
		"storage_by_unifyapps"
	],
	"createdTime":1726395621443,
	"deleted":false,
	"deploymentState":{
		"deployedAt":1760296307376,
		"deployedBy":-1,
		"deployedDefinitionId":"68ebfd73c022db31dbd6cdb7",
		"status":"DEPLOYED",
		"version":76,
		"workflowVersion":146
	},
	"edges":[
		{
			"fromNodeId":"t6Cuj",
			"priority":0,
			"skip":false,
			"toNodeId":"I5Gmn",
			"type":"next"
		},
		{
			"fromNodeId":"I5Gmn",
			"priority":0,
			"skip":false,
			"toNodeId":"n_cCENh",
			"type":"next"
		},
		{
			"fromNodeId":"n_cCENh",
			"priority":0,
			"skip":false,
			"toNodeId":"BVzpJ",
			"type":"next"
		},
		{
			"fromNodeId":"BVzpJ",
			"priority":0,
			"skip":false,
			"toNodeId":"qCZ4m",
			"type":"next"
		},
		{
			"fromNodeId":"qCZ4m",
			"priority":0,
			"skip":false,
			"toNodeId":"2GiCz",
			"type":"next"
		},
		{
			"fromNodeId":"2GiCz",
			"priority":0,
			"skip":false,
			"toNodeId":"HLhcy",
			"type":"next"
		},
		{
			"fromNodeId":"HLhcy",
			"priority":0,
			"skip":false,
			"toNodeId":"mT2lX",
			"type":"next"
		},
		{
			"fromNodeId":"mT2lX",
			"priority":0,
			"skip":false,
			"toNodeId":"igmCh",
			"type":"next"
		},
		{
			"fromNodeId":"igmCh",
			"priority":0,
			"skip":false,
			"toNodeId":"et74k",
			"type":"next"
		},
		{
			"fromNodeId":"et74k",
			"name":"yes",
			"priority":0,
			"skip":false,
			"toNodeId":"kkYOq",
			"type":"if"
		},
		{
			"fromNodeId":"kkYOq",
			"name":"yes",
			"priority":0,
			"skip":false,
			"toNodeId":"g3sHT",
			"type":"if"
		},
		{
			"fromNodeId":"g3sHT",
			"priority":0,
			"skip":false,
			"toNodeId":"BCaqm",
			"type":"next"
		},
		{
			"fromNodeId":"kkYOq",
			"name":"no",
			"priority":0,
			"skip":false,
			"toNodeId":"a8nmR",
			"type":"next"
		},
		{
			"fromNodeId":"a8nmR",
			"priority":0,
			"skip":false,
			"toNodeId":"DsgdE",
			"type":"next"
		},
		{
			"fromNodeId":"et74k",
			"name":"no",
			"priority":0,
			"skip":false,
			"toNodeId":"Fe2qE",
			"type":"next"
		},
		{
			"fromNodeId":"Fe2qE",
			"name":"yes",
			"priority":0,
			"skip":false,
			"toNodeId":"r96X7",
			"type":"if"
		},
		{
			"fromNodeId":"r96X7",
			"priority":0,
			"skip":false,
			"toNodeId":"7L4iA",
			"type":"next"
		},
		{
			"fromNodeId":"Fe2qE",
			"name":"no",
			"priority":0,
			"skip":false,
			"toNodeId":"7SVn8",
			"type":"next"
		},
		{
			"fromNodeId":"7SVn8",
			"priority":0,
			"skip":false,
			"toNodeId":"mxlHb",
			"type":"next"
		},
		{
			"fromNodeId":"BCaqm",
			"priority":0,
			"skip":false,
			"toNodeId":"QgH4H",
			"type":"next"
		},
		{
			"fromNodeId":"DsgdE",
			"priority":0,
			"skip":false,
			"toNodeId":"QgH4H",
			"type":"next"
		},
		{
			"fromNodeId":"7L4iA",
			"priority":0,
			"skip":false,
			"toNodeId":"QgH4H",
			"type":"next"
		},
		{
			"fromNodeId":"mxlHb",
			"priority":0,
			"skip":false,
			"toNodeId":"QgH4H",
			"type":"next"
		},
		{
			"fromNodeId":"QgH4H",
			"priority":0,
			"skip":false,
			"toNodeId":"2UtlP",
			"type":"next"
		},
		{
			"fromNodeId":"2UtlP",
			"priority":0,
			"skip":false,
			"toNodeId":"rvMsg",
			"type":"next"
		},
		{
			"fromNodeId":"rvMsg",
			"priority":0,
			"skip":false,
			"toNodeId":"uEOQH",
			"type":"next"
		},
		{
			"fromNodeId":"uEOQH",
			"name":"success",
			"priority":0,
			"skip":false,
			"toNodeId":"Bta9m",
			"type":"next"
		},
		{
			"fromNodeId":"Bta9m",
			"priority":0,
			"skip":false,
			"toNodeId":"ceNN2",
			"type":"next"
		},
		{
			"fromNodeId":"ceNN2",
			"priority":0,
			"skip":false,
			"toNodeId":"YVjne",
			"type":"next"
		},
		{
			"fromNodeId":"YVjne",
			"priority":0,
			"skip":false,
			"toNodeId":"tMBe4",
			"type":"loop"
		},
		{
			"fromNodeId":"tMBe4",
			"name":"loopback",
			"priority":0,
			"skip":false,
			"toNodeId":"YVjne",
			"type":"next"
		},
		{
			"fromNodeId":"YVjne",
			"priority":0,
			"skip":false,
			"toNodeId":"A2qrH",
			"type":"next"
		},
		{
			"fromNodeId":"uEOQH",
			"name":"error",
			"priority":0,
			"skip":false,
			"toNodeId":"UWaYe",
			"type":"error"
		},
		{
			"fromNodeId":"UWaYe",
			"priority":0,
			"skip":false,
			"toNodeId":"2H7hu",
			"type":"next"
		},
		{
			"fromNodeId":"2H7hu",
			"priority":0,
			"skip":false,
			"toNodeId":"lelhq",
			"type":"next"
		},
		{
			"fromNodeId":"lelhq",
			"priority":0,
			"skip":false,
			"toNodeId":"P8e4j",
			"type":"loop"
		},
		{
			"fromNodeId":"P8e4j",
			"name":"loopback",
			"priority":0,
			"skip":false,
			"toNodeId":"lelhq",
			"type":"next"
		},
		{
			"fromNodeId":"A2qrH",
			"priority":0,
			"skip":false,
			"toNodeId":"YpdHq",
			"type":"next"
		},
		{
			"fromNodeId":"lelhq",
			"priority":0,
			"skip":false,
			"toNodeId":"YpdHq",
			"type":"next"
		}
	],
	"grants":{
		"configs":[
			{
				"permissions":[
					"V"
				],
				"principalType":"GLOBAL"
			}
		]
	},
	"id":"66e6b4e5e02e700fca2dd3aa",
	"lastModifiedBy":0,
	"lcName":"response generation(feedback, tone,style,format) {do not touch}",
	"modifiedTime":1761722860671,
	"name":"Response Generation(Feedback, TOne,Style,Format) {DO NOT TOUCH}",
	"nodes":[
		{
			"context":{
				"appName":"callables",
				"resourceVersion":46,
				"resourceName":"callables_from_automation"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"cpPNH-1",
			"id":"t6Cuj",
			"index":0,
			"inputs":{
				"result":{
					"type":"object",
					"properties":{
						"response":{
							"type":"string",
							"title":"Response"
						},
						"reference":{
							"type":"array",
							"items":{
								"type":"number"
							},
							"title":"Reference"
						}
					},
					"additionalProperties":false,
					"required":[]
				},
				"setup":{
					"type":"object",
					"properties":{
						"aiAgentId":{
							"type":"string",
							"title":"Ai Agent Id"
						},
						"userQuery":{
							"type":"string",
							"title":"User Query"
						},
						"promptVariables":{
							"type":"object",
							"properties":{},
							"additionalProperties":false,
							"title":"Prompt Variables"
						}
					},
					"additionalProperties":false,
					"required":[]
				}
			},
			"skip":false,
			"subTitle":"Callable",
			"title":"Trigger from automation",
			"trigger":{
				"type":"CALLABLE"
			},
			"type":"START"
		},
		{
			"context":{
				"appName":"storage_by_unifyapps",
				"resourceVersion":980,
				"resourceName":"storage_by_unifyapps_fetch_records",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"cpPNH-1",
			"id":"I5Gmn",
			"index":0,
			"inputs":{
				"triggerInputCondition":{
					"filters":[
						{
							"property":"properties_aiAgentId",
							"filter":{
								"operator":"EQUAL",
								"value":"{{ t6Cuj.outputs.aiAgentId }}"
							}
						},
						{
							"property":"properties_type",
							"filter":{
								"operator":"EQUAL",
								"value":"RESPONSE_GENERATION"
							}
						}
					],
					"operator":"AND"
				},
				"object_type":"prompt",
				"page":{
					"limit":20,
					"offset":0
				},
				"numberOfRecordsToFetch":"SINGLE",
				"includeTotalCount":false
			},
			"skip":false,
			"subTitle":"Storage by UnifyApps",
			"title":"Fetch records",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"callables",
				"resourceVersion":458,
				"resourceName":"callables_call_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"cpPNH-1",
			"id":"n_cCENh",
			"index":0,
			"inputs":{
				"automationId":"67a48d37f8f1744841dabb63",
				"runtimeConnections":{},
				"synchronous":true,
				"version":"-1",
				"parameters":{
					"aiAgentId":"{{ t6Cuj.outputs.aiAgentId }}"
				}
			},
			"skip":false,
			"subTitle":"Callable",
			"title":"Call automation",
			"type":"CALL_WORKFLOW"
		},
		{
			"additional":{
				"visibleOptionalFields":[
					"root.input_schema.tone",
					"root.input_schema.format",
					"root.input_schema.style",
					"root.input_schema.language"
				]
			},
			"context":{
				"appName":"template_by_unifyapps",
				"resourceVersion":83,
				"resourceName":"template_by_unifyapps_compile_template",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"cpPNH-1",
			"id":"BVzpJ",
			"index":0,
			"inputs":{
				"input_schema":{
					"tone":"{{ n_cCENh.outputs.properties.responseGenerationSettings.tone }}",
					"format":"{{ n_cCENh.outputs.properties.responseGenerationSettings.format }}",
					"style":"{{ n_cCENh.outputs.properties.responseGenerationSettings.style }}",
					"language":"{{ n_cCENh.outputs.properties.responseGenerationSettings.language }}"
				},
				"template_id":"e_66e6b68e1336c853257409ed"
			},
			"skip":false,
			"subTitle":"Persona Template",
			"title":"Compile template",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"openai",
				"resourceVersion":5,
				"connectionId":"669a2ee5b16db42aab702bf1",
				"resourceName":"openai_generate_text_embedding",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"cpPNH-1",
			"id":"qCZ4m",
			"index":0,
			"inputs":{
				"model":"text-embedding-ada-002",
				"text":"{{ t6Cuj.outputs.userQuery }}",
				"user":"user"
			},
			"skip":false,
			"subTitle":"OpenAI",
			"title":"Generate text embedding",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"storage_by_unifyapps",
				"resourceVersion":2,
				"resourceName":"storage_by_unifyapps_semantic_query_records",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"cpPNH-1",
			"id":"2GiCz",
			"index":0,
			"inputs":{
				"hybridSearch":false,
				"searchField":{
					"field":"properties.embeddings",
					"op":"KNN",
					"values":"{{ qCZ4m.outputs.data[0].embedding }}"
				},
				"object_type":"feedbackloop_object",
				"numberOfRecordsToFetch":10
			},
			"skip":false,
			"subTitle":"Storage by UnifyApps",
			"title":"Semantic search records",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"code_by_unifyapps",
				"resourceVersion":18,
				"resourceName":"code_by_unifyapps_python",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"CONTINUE",
			"groupId":"cpPNH-1",
			"id":"HLhcy",
			"index":0,
			"inputs":{
				"output":{
					"type":"object",
					"properties":{
						"previous_feedback":{
							"type":"string",
							"title":"previous_feedback"
						}
					},
					"additionalProperties":false,
					"required":[]
				},
				"input":{
					"type":"object",
					"properties":{
						"Objects":{
							"type":"array",
							"items":{
								"type":"object",
								"properties":{
									"question":{
										"type":"string",
										"title":"question"
									},
									"answer":{
										"type":"string",
										"title":"answer"
									},
									"feedbackCategories":{
										"type":"array",
										"items":{
											"type":"string"
										},
										"title":"feedbackCategories"
									},
									"reaction":{
										"type":"string",
										"title":"reaction"
									},
									"userFeedback":{
										"type":"string",
										"title":"userFeedback"
									}
								},
								"additionalProperties":false
							},
							"title":"Objects",
							"required":[]
						},
						"user_query":{
							"type":"string",
							"title":"user_query"
						}
					},
					"additionalProperties":false,
					"required":[]
				},
				"code":"import json\n\n# Initialize variables to store the best match\nbest_match = None\nbest_ratio = 0\n\n\n# Iterate through each object in the list\ntry:\n    for obj in Objects:\n        s1=user_query\n        s2=obj['question']\n        len1 = len(s1)\n        len2 = len(s2)\n\n        # Initialize variables\n        prev_row = list(range(len2 + 1))\n        current_row = [0] * (len2 + 1)\n\n        # Calculate Levenshtein distance\n        for i in range(1, len1 + 1):\n            current_row[0] = i\n            for j in range(1, len2 + 1):\n                if s1[i-1] == s2[j-1]:\n                    current_row[j] = prev_row[j-1]\n                else:\n                    current_row[j] = min(prev_row[j], current_row[j-1], prev_row[j-1]) + 1\n            prev_row, current_row = current_row, prev_row\n\n        # Calculate the distance and ratio\n        distance = prev_row[len2]\n        max_len = max(len1, len2)\n        ratio = ((max_len - distance) / max_len) * 100\n\n            \n            # Update the best match if this ratio is higher\n        if ratio > best_ratio:\n            best_ratio = ratio\n            best_match = obj\n\n    # Check if the best match is above the 80% threshold\n    if best_ratio > 80:\n        reaction = best_match['reaction']\n        userFeedback = best_match['userFeedback']\n        answer = best_match['answer']\n        question = best_match['question']\n        feedbackCategories=best_match['feedbackCategories']\n        \n        st = \"The previous feedback suggests \" + reaction + \" reaction with user feedback: '\" + userFeedback + \"' on '\" + answer + \"' to this question: '\" + question + \"'. Feedback categories: \" + str(feedbackCategories)\n        previous_feedback = st\n    else:\n        previous_feedback = \"good\"\nexcept:\n    previous_feedback = \"good\"\n\nresult = {\"previous_feedback\": previous_feedback}",
				"isAsync":false,
				"parameters":{
					"Objects":{
						"source":"{{ 2GiCz.outputs.objects }}",
						"ua:type":"mappedArray",
						"items":{
							"question":"{{ 2GiCz.outputs.objects[0].document.properties.question }}",
							"answer":"{{ 2GiCz.outputs.objects[0].document.properties.answer }}",
							"feedbackCategories":{
								"source":"{{ 2GiCz.outputs.objects[0].document.properties.feedbackCategories }}",
								"ua:type":"mappedArray",
								"items":"{{ 2GiCz.outputs.objects[0].document.properties.feedbackCategories[0] }}"
							},
							"reaction":"{{ 2GiCz.outputs.objects[0].document.properties.Reaction }}",
							"userFeedback":"{{ 2GiCz.outputs.objects[0].document.properties.userFeedback }}"
						}
					},
					"user_query":"{{ t6Cuj.outputs.userQuery }}"
				}
			},
			"options":{
				"businessHoursConfig":{
					"enabled":false,
					"waitForNextWindow":false
				},
				"cacheConfig":{
					"enabled":false
				},
				"circuitBreakerConfig":{
					"enabled":false
				},
				"disableLogging":false,
				"enabledForReExecution":false,
				"rateLimitConfig":{
					"enabled":false,
					"waitForNextWindow":false
				},
				"retryConfig":{
					"backOffFactor":null,
					"captureRetries":false,
					"enabled":false
				},
				"stepError":"CONTINUE"
			},
			"skip":false,
			"subTitle":"Code by UnifyApps",
			"title":"Execute Python script",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"code_by_unifyapps",
				"resourceVersion":52,
				"resourceName":"code_by_unifyapps_groovy",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"cpPNH-1",
			"id":"mT2lX",
			"index":0,
			"inputs":{
				"output":{
					"type":"object",
					"properties":{
						"inputMapping":{
							"type":"object",
							"properties":{},
							"additionalProperties":false,
							"title":"Input Mapping"
						}
					},
					"additionalProperties":false,
					"required":[]
				},
				"input":{
					"type":"object",
					"properties":{
						"userQuery":{
							"type":"string",
							"title":"User Query"
						},
						"promptSchema":{
							"type":"object",
							"properties":{},
							"additionalProperties":false,
							"title":"Prompt Schema"
						},
						"promptVariables":{
							"type":"object",
							"properties":{},
							"additionalProperties":false,
							"title":"Prompt Variables"
						},
						"persona":{
							"type":"string",
							"title":"persona"
						},
						"previousFeedback":{
							"type":"string",
							"title":"previousFeedback"
						},
						"promptContent":{
							"type":"string",
							"title":"Prompt Content"
						}
					},
					"additionalProperties":false,
					"required":[]
				},
				"compile_static":false,
				"code":"def inputMapping = [\"userQuery\": userQuery]\ntry{\npromptSchema.each(key, value -> {\n   //inputSchema.put(key, resolved)\n} )\n} catch(Exception e) { }\ninputMapping.putAll(promptVariables)\nif (persona instanceof String) {\n    inputMapping.put(\"persona\", persona)\n} else if (persona instanceof Map) {\n    inputMapping.putAll(persona)\n}\nif (previousFeedback instanceof String) {\n    inputMapping.put(\"previousFeedback\", previousFeedback)\n} else if (previousFeedback instanceof Map) {\n    inputMapping.putAll(previousFeedback)\n}\nif(binding.hasVariable('promptContent')) {\n    inputMapping.put(\"promptContent\", promptContent)\n}\nreturn [\"inputMapping\" : inputMapping]\n",
				"isAsync":false,
				"parameters":{
					"userQuery":"{{ t6Cuj.outputs.userQuery }}",
					"promptSchema":"{{ I5Gmn.outputs.properties.promptSchema }}",
					"promptVariables":"{{ t6Cuj.outputs.promptVariables }}",
					"persona":"{{ BVzpJ.outputs.output }}",
					"previousFeedback":"{{ HLhcy.outputs.result.previous_feedback }}",
					"promptContent":"{{ I5Gmn.outputs.properties.promptContent }}"
				}
			},
			"skip":false,
			"subTitle":"Code By UnifyApps",
			"title":"Execute groovy code",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"variable_by_unifyapps",
				"resourceVersion":120,
				"resourceName":"variable_by_unifyapps_create_variables",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"cpPNH-1",
			"id":"igmCh",
			"index":0,
			"inputSchema":{
				"type":"SCHEMA_AND_LAYOUT",
				"dynamic":false,
				"layout":{},
				"schema":{
					"additionalProperties":false,
					"type":"object",
					"properties":{
						"resolvedPrompt":{
							"type":"string",
							"title":"resolvedPrompt"
						}
					}
				}
			},
			"inputs":{},
			"outputSchema":{
				"dynamic":false,
				"schema":{
					"additionalProperties":false,
					"type":"object",
					"properties":{
						"resolvedPrompt":{
							"type":"string",
							"title":"resolvedPrompt"
						}
					}
				}
			},
			"skip":false,
			"subTitle":"Variable by UnifyApps",
			"title":"Create variables",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"if_else",
				"resourceVersion":44,
				"resourceName":"if_else_condition",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"cpPNH-1",
			"id":"et74k",
			"index":0,
			"inputs":{
				"filters":[
					{
						"property":"{{ I5Gmn.outputs.id }}",
						"filter":{
							"operator":"EXISTS"
						}
					}
				],
				"operator":"AND"
			},
			"skip":false,
			"subTitle":"Condition",
			"title":"Condition",
			"type":"IF_ELSE"
		},
		{
			"context":{
				"appName":"if_else",
				"resourceVersion":50,
				"resourceName":"if_else_condition",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"et74k@cpPNH-1@y",
			"id":"kkYOq",
			"index":0,
			"inputs":{
				"filters":[
					{
						"property":"{{ HLhcy.outputs.result.previous_feedback }}",
						"filter":{
							"operator":"EQUAL",
							"value":"good"
						}
					}
				],
				"operator":"AND"
			},
			"skip":false,
			"subTitle":"Condition",
			"title":"Condition",
			"type":"IF_ELSE"
		},
		{
			"context":{
				"appName":"template_by_unifyapps",
				"resourceVersion":83,
				"resourceName":"template_by_unifyapps_compile_template",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"kkYOq@et74k@cpPNH-1@y@y",
			"id":"g3sHT",
			"index":0,
			"inputs":{
				"input_schema":"{{ mT2lX.outputs.result.inputMapping }}",
				"template_id":"e_66e847bc8891ba404a8b6050"
			},
			"skip":false,
			"subTitle":"Template by UnifyApps",
			"title":"Compile template",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"variable_by_unifyapps",
				"resourceVersion":62,
				"resourceName":"variable_by_unifyapps_update_variables",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"kkYOq@et74k@cpPNH-1@y@y",
			"id":"BCaqm",
			"index":0,
			"inputs":{
				"variables":[
					{
						"source":"{{ igmCh.outputs.resolvedPrompt }}",
						"value":"{{ g3sHT.outputs.output }}"
					}
				]
			},
			"skip":false,
			"subTitle":"Variable by UnifyApps",
			"title":"Update variables",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"template_by_unifyapps",
				"resourceVersion":83,
				"resourceName":"template_by_unifyapps_compile_template",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"kkYOq@et74k@cpPNH-1@y@n",
			"id":"a8nmR",
			"index":0,
			"inputs":{
				"input_schema":"{{ mT2lX.outputs.result.inputMapping }}",
				"template_id":"e_66e8483d11b4e568f5106a67"
			},
			"skip":false,
			"subTitle":"Template by UnifyApps",
			"title":"Compile template",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"variable_by_unifyapps",
				"resourceVersion":62,
				"resourceName":"variable_by_unifyapps_update_variables",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"kkYOq@et74k@cpPNH-1@y@n",
			"id":"DsgdE",
			"index":0,
			"inputs":{
				"variables":[
					{
						"source":"{{ igmCh.outputs.resolvedPrompt }}",
						"value":"{{ a8nmR.outputs.output }}"
					}
				]
			},
			"skip":false,
			"subTitle":"Variable by UnifyApps",
			"title":"Update variables",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"if_else",
				"resourceVersion":50,
				"resourceName":"if_else_condition",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"et74k@cpPNH-1@n",
			"id":"Fe2qE",
			"index":0,
			"inputs":{
				"filters":[
					{
						"property":"{{ HLhcy.outputs.result.previous_feedback }}",
						"filter":{
							"operator":"EQUAL",
							"value":"good"
						}
					}
				],
				"operator":"AND"
			},
			"skip":false,
			"subTitle":"Condition",
			"title":"Condition",
			"type":"IF_ELSE"
		},
		{
			"context":{
				"appName":"template_by_unifyapps",
				"resourceVersion":83,
				"resourceName":"template_by_unifyapps_compile_template",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"Fe2qE@et74k@cpPNH-1@n@y",
			"id":"r96X7",
			"index":0,
			"inputs":{
				"input_schema":"{{ mT2lX.outputs.result.inputMapping }}",
				"template_id":"e_66e8495411b4e568f5106a69"
			},
			"skip":false,
			"subTitle":"Template by UnifyApps",
			"title":"Compile template",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"variable_by_unifyapps",
				"resourceVersion":62,
				"resourceName":"variable_by_unifyapps_update_variables",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"Fe2qE@et74k@cpPNH-1@n@y",
			"id":"7L4iA",
			"index":0,
			"inputs":{
				"variables":[
					{
						"source":"{{ igmCh.outputs.resolvedPrompt }}",
						"value":"{{ r96X7.outputs.output }}"
					}
				]
			},
			"skip":false,
			"subTitle":"Variable by UnifyApps",
			"title":"Update variables",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"template_by_unifyapps",
				"resourceVersion":83,
				"resourceName":"template_by_unifyapps_compile_template",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"Fe2qE@et74k@cpPNH-1@n@n",
			"id":"7SVn8",
			"index":0,
			"inputs":{
				"input_schema":"{{ mT2lX.outputs.result.inputMapping }}",
				"template_id":"e_66e84a0711b4e568f5106a6e"
			},
			"skip":false,
			"subTitle":"Template by UnifyApps",
			"title":"Compile template",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"variable_by_unifyapps",
				"resourceVersion":62,
				"resourceName":"variable_by_unifyapps_update_variables",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"Fe2qE@et74k@cpPNH-1@n@n",
			"id":"mxlHb",
			"index":0,
			"inputs":{
				"variables":[
					{
						"source":"{{ igmCh.outputs.resolvedPrompt }}",
						"value":"{{ 7SVn8.outputs.output }}"
					}
				]
			},
			"skip":false,
			"subTitle":"Variable by UnifyApps",
			"title":"Update variables",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"callables",
				"resourceVersion":48,
				"resourceName":"callables_call_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"cpPNH-1",
			"id":"QgH4H",
			"index":0,
			"inputs":{
				"automationId":"66dfd76eb70dad256986b784",
				"runtimeConnections":{},
				"synchronous":true,
				"version":"-1",
				"parameters":{
					"type":"text",
					"response_format":"text",
					"aiAgentId":"{{ t6Cuj.outputs.aiAgentId }}",
					"content":"{{ igmCh.outputs.resolvedPrompt }}",
					"modelId":"{{ n_cCENh.outputs.properties.responseGenerationSettings.answerGenerationModelSettings.modelId }}"
				}
			},
			"skip":false,
			"subTitle":"Call LLM",
			"title":"Call automation",
			"type":"CALL_WORKFLOW"
		},
		{
			"context":{
				"appName":"variable_by_unifyapps",
				"resourceVersion":120,
				"resourceName":"variable_by_unifyapps_create_variables",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"cpPNH-1",
			"id":"2UtlP",
			"index":0,
			"inputSchema":{
				"type":"SCHEMA_AND_LAYOUT",
				"dynamic":false,
				"layout":{
					"ui:submitButtonOptions":{
						"norender":true
					}
				},
				"schema":{
					"additionalProperties":false,
					"type":"object",
					"properties":{
						"answer":{
							"type":"string",
							"title":"answer"
						}
					},
					"required":[]
				}
			},
			"inputs":{},
			"outputSchema":{
				"dynamic":false,
				"schema":{
					"additionalProperties":false,
					"type":"object",
					"properties":{
						"answer":{
							"type":"string",
							"title":"answer"
						}
					},
					"required":[]
				}
			},
			"skip":false,
			"subTitle":"Variable by UnifyApps",
			"title":"Create variables",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"variable_by_unifyapps",
				"resourceVersion":121,
				"resourceName":"variable_by_unifyapps_create_list",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"cpPNH-1",
			"id":"rvMsg",
			"index":0,
			"inputSchema":{
				"type":"SCHEMA_AND_LAYOUT",
				"dynamic":false,
				"layout":{
					"createList":{
						"ui:title":"",
						"ua:type":{
							"ui:widget":"hidden"
						},
						"items":{
							"ui:title":"Initial list items",
							"ui:description":"Set the initial values of the list (defaults to empty)"
						},
						"ui:order":[
							"*",
							"items"
						]
					},
					"ua:title":{
						"ui:widget":"hidden"
					},
					"ua:list_type":{
						"ui:widget":"hidden"
					}
				},
				"schema":{
					"allOf":[
						{
							"if":{
								"properties":{
									"ua:list_type":{
										"const":"OBJECT"
									}
								}
							},
							"then":{
								"properties":{
									"createList":{
										"type":"object",
										"properties":{
											"items":{
												"type":"object",
												"properties":{}
											}
										}
									}
								}
							}
						},
						{
							"if":{
								"properties":{
									"ua:list_type":{
										"const":"STRING"
									}
								}
							},
							"then":{
								"properties":{
									"createList":{
										"type":"object",
										"properties":{
											"source":{
												"type":"string",
												"format":"ua:source",
												"title":"List of String"
											},
											"items":{
												"type":"string"
											}
										}
									}
								}
							}
						},
						{
							"if":{
								"properties":{
									"ua:list_type":{
										"const":"INTEGER"
									}
								}
							},
							"then":{
								"properties":{
									"createList":{
										"type":"object",
										"properties":{
											"source":{
												"type":"string",
												"format":"ua:source",
												"title":"List of Integers"
											},
											"items":{
												"type":"integer"
											}
										}
									}
								}
							}
						},
						{
							"if":{
								"properties":{
									"ua:list_type":{
										"const":"NUMBER"
									}
								}
							},
							"then":{
								"properties":{
									"createList":{
										"type":"object",
										"properties":{
											"source":{
												"type":"string",
												"format":"ua:source",
												"title":"List of Numbers"
											},
											"items":{
												"type":"number"
											}
										}
									}
								}
							}
						},
						{
							"if":{
								"properties":{
									"ua:list_type":{
										"const":"BOOLEAN"
									}
								}
							},
							"then":{
								"properties":{
									"createList":{
										"type":"object",
										"properties":{
											"source":{
												"type":"string",
												"format":"ua:source",
												"title":"List of Booleans"
											},
											"items":{
												"type":"boolean"
											}
										}
									}
								}
							}
						}
					],
					"format":"ua:list",
					"type":"object",
					"properties":{
						"ua:title":{
							"type":"string"
						},
						"ua:list_type":{
							"type":"string",
							"title":"List Type",
							"oneOf":[
								{
									"const":"OBJECT",
									"title":"Object"
								},
								{
									"const":"STRING",
									"title":"String"
								},
								{
									"const":"NUMBER",
									"title":"Number"
								},
								{
									"const":"INTEGER",
									"title":"Integer"
								},
								{
									"const":"BOOLEAN",
									"title":"Boolean"
								}
							],
							"default":"OBJECT"
						},
						"createList":{
							"type":"object",
							"properties":{
								"ua:type":{
									"type":"string",
									"default":"mappedArray"
								},
								"source":{
									"type":"string",
									"format":"ua:source",
									"title":"List Item Source"
								},
								"items":{
									"additionalProperties":false,
									"type":[
										"object",
										"string",
										"number",
										"boolean",
										"integer"
									],
									"properties":{}
								}
							}
						}
					}
				}
			},
			"inputs":{
				"createList":{
					"ua:type":"mappedArray"
				},
				"ua:title":"reference_list",
				"ua:list_type":"INTEGER"
			},
			"outputSchema":{
				"dynamic":false,
				"schema":{
					"type":"object",
					"properties":{
						"items":{
							"type":"array",
							"title":"reference_list",
							"disableActions":true,
							"items":{
								"type":"integer"
							}
						}
					}
				}
			},
			"skip":false,
			"subTitle":"Variable by UnifyApps",
			"title":"Create list",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"utility_by_unifyapps",
				"resourceVersion":18,
				"resourceName":"utility_by_unifyapps_to_json_object",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"MANUAL",
			"groupId":"cpPNH-1",
			"id":"uEOQH",
			"index":0,
			"inputs":{
				"jsonSchema":{
					"type":"object",
					"properties":{
						"reference":{
							"type":"array",
							"items":{
								"type":"integer"
							},
							"title":"reference"
						},
						"answer":{
							"type":"string",
							"title":"answer"
						},
						"relevancy_reason":{
							"type":"string",
							"title":"relevancy_reason"
						}
					},
					"additionalProperties":false,
					"required":[]
				},
				"jsonString":"{{ QgH4H.outputs.llmResponse }}"
			},
			"options":{
				"businessHoursConfig":{
					"enabled":false,
					"waitForNextWindow":false
				},
				"cacheConfig":{
					"enabled":false
				},
				"circuitBreakerConfig":{
					"enabled":false
				},
				"disableLogging":false,
				"enabledForReExecution":false,
				"rateLimitConfig":{
					"enabled":false,
					"waitForNextWindow":false
				},
				"retryConfig":{
					"backOffFactor":null,
					"captureRetries":false,
					"enabled":false
				},
				"stepError":"MANUAL"
			},
			"skip":false,
			"subTitle":"Utility by UnifyApps",
			"title":"Deserialise string to JSON object",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"code_by_unifyapps",
				"resourceVersion":18,
				"resourceName":"code_by_unifyapps_python",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"uEOQH@cpPNH-1@success",
			"id":"Bta9m",
			"index":0,
			"inputs":{
				"output":{
					"type":"object",
					"properties":{
						"referenceList":{
							"type":"array",
							"items":{
								"type":"integer"
							},
							"title":"referenceList"
						},
						"response":{
							"type":"string",
							"title":"response"
						}
					},
					"additionalProperties":false
				},
				"input":{
					"type":"object",
					"properties":{
						"referenceList":{
							"type":"array",
							"items":{
								"type":"integer"
							},
							"title":"referenceList"
						},
						"response":{
							"type":"string",
							"title":"response"
						}
					},
					"additionalProperties":false,
					"required":[]
				},
				"code":"import re\nimport ast\nreference_list=[]\ntry:\n    if not referenceList:\n        pattern = r\"Reference:\\s*(\\[.*?\\])$\"\n        match = re.search(pattern, response, re.DOTALL)\n\n        if match:\n            reference_list = ast.literal_eval(match.group(1))\n        else:\n            reference_list=[]\n    else:\n        reference_list=referenceList\nexcept:\n    reference_list=[]\n\nresult={\"referenceList\":reference_list,\"response\":response}",
				"isAsync":false,
				"parameters":{
					"referenceList":{
						"source":"{{ uEOQH.outputs.result.reference }}",
						"ua:type":"mappedArray",
						"items":"{{ uEOQH.outputs.result.reference[0] }}"
					},
					"response":"{{ uEOQH.outputs.result.answer }}"
				}
			},
			"options":{
				"businessHoursConfig":{
					"enabled":false,
					"waitForNextWindow":false
				},
				"cacheConfig":{
					"enabled":false
				},
				"circuitBreakerConfig":{
					"enabled":false
				},
				"disableLogging":false,
				"enabledForReExecution":false,
				"rateLimitConfig":{
					"enabled":false,
					"waitForNextWindow":false
				},
				"retryConfig":{
					"backOffFactor":null,
					"captureRetries":false,
					"enabled":false
				},
				"stepError":"STOP"
			},
			"skip":false,
			"subTitle":"Code by UnifyApps",
			"title":"Execute Python script",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"variable_by_unifyapps",
				"resourceVersion":62,
				"resourceName":"variable_by_unifyapps_update_variables",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"uEOQH@cpPNH-1@success",
			"id":"ceNN2",
			"index":0,
			"inputs":{
				"variables":[
					{
						"source":"{{ 2UtlP.outputs.answer }}",
						"value":"{{ Bta9m.outputs.result.response }}"
					}
				]
			},
			"skip":false,
			"subTitle":"Variable by UnifyApps",
			"title":"Update variables",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"loop",
				"resourceVersion":93,
				"resourceName":"loop_for_each",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"uEOQH@cpPNH-1@success",
			"id":"YVjne",
			"index":0,
			"inputs":{
				"repeatMode":"SINGLE",
				"listSource":"{{ uEOQH.outputs.result.reference }}"
			},
			"skip":false,
			"subTitle":"Loop",
			"title":"For loop",
			"type":"LOOP"
		},
		{
			"context":{
				"appName":"variable_by_unifyapps",
				"resourceVersion":68,
				"resourceName":"variable_by_unifyapps_add_item_to_list",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"YVjne@uEOQH@cpPNH-1@success@l",
			"id":"tMBe4",
			"index":0,
			"inputs":{
				"itemToAdd":"{{ YVjne.outputs.item }}",
				"insertLocation":"END",
				"listName":"{{ rvMsg.outputs.items[0] }}"
			},
			"skip":false,
			"subTitle":"Variable by UnifyApps",
			"title":"Add item to list",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"variable_by_unifyapps",
				"resourceVersion":120,
				"resourceName":"variable_by_unifyapps_create_variables",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"uEOQH@cpPNH-1@success",
			"id":"A2qrH",
			"index":0,
			"inputSchema":{
				"type":"SCHEMA_AND_LAYOUT",
				"dynamic":false,
				"layout":{},
				"schema":{
					"additionalProperties":false,
					"type":"object",
					"properties":{
						"temp":{
							"type":"string",
							"title":"Temp"
						}
					},
					"required":[]
				}
			},
			"inputs":{},
			"outputSchema":{
				"dynamic":false,
				"schema":{
					"additionalProperties":false,
					"type":"object",
					"properties":{
						"temp":{
							"type":"string",
							"title":"Temp"
						}
					},
					"required":[]
				}
			},
			"skip":false,
			"subTitle":"Variable by UnifyApps",
			"title":"Create variables",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"code_by_unifyapps",
				"resourceVersion":18,
				"resourceName":"code_by_unifyapps_python",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"uEOQH@cpPNH-1@error",
			"id":"UWaYe",
			"index":0,
			"inputs":{
				"output":{
					"type":"object",
					"properties":{
						"reference":{
							"type":"array",
							"items":{
								"type":"integer"
							},
							"title":"reference"
						},
						"answer":{
							"type":"string",
							"title":"answer"
						},
						"relevancy_reason":{
							"type":"string",
							"title":"relevancy_reason"
						}
					},
					"additionalProperties":false
				},
				"input":{
					"type":"object",
					"properties":{
						"input_string":{
							"type":"string",
							"title":"input_string"
						}
					},
					"additionalProperties":false
				},
				"code":"import re\n\n# Extract relevancy reason\nrelevancy_reason_match = re.search(r'\"relevancy_reason\":\\s*\"(.*?)\"', input_string, re.DOTALL)\nrelevancy_reason = relevancy_reason_match.group(1) if relevancy_reason_match else \"\"\n\n# Extract answer (captures everything between \"answer\": and ,\"reference\":)\nanswer_match = re.search(r'\"answer\":\\s*(.*?)(?=\\s*,\\s*\"reference\":)', input_string, re.DOTALL)\nanswer = answer_match.group(1).strip() if answer_match else \"\"\n\n# Remove leading/trailing quotes if present\nanswer = answer.strip('\"')\n\n# Extract reference list\nreference_match = re.search(r'\"reference\":\\s*\\[(.*?)\\]', input_string)\nreference_list = [int(num.strip()) for num in reference_match.group(1).split(',') if num.strip()] if reference_match else []\n\nresult = {\"relevancy_reason\": relevancy_reason, \"answer\": answer, \"reference\": reference_list}",
				"isAsync":false,
				"parameters":{
					"input_string":"{{ QgH4H.outputs.llmResponse }}"
				}
			},
			"skip":false,
			"subTitle":"Code by UnifyApps",
			"title":"Execute Python script",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"variable_by_unifyapps",
				"resourceVersion":62,
				"resourceName":"variable_by_unifyapps_update_variables",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"uEOQH@cpPNH-1@error",
			"id":"2H7hu",
			"index":0,
			"inputs":{
				"variables":[
					{
						"source":"{{ 2UtlP.outputs.answer }}",
						"value":"{{ UWaYe.outputs.result.answer }}"
					}
				]
			},
			"skip":false,
			"subTitle":"Variable by UnifyApps",
			"title":"Update variables",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"loop",
				"resourceVersion":93,
				"resourceName":"loop_for_each",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"uEOQH@cpPNH-1@error",
			"id":"lelhq",
			"index":0,
			"inputs":{
				"repeatMode":"SINGLE",
				"listSource":"{{ UWaYe.outputs.result.reference }}",
				"captureIterations":false
			},
			"skip":false,
			"subTitle":"Loop",
			"title":"For loop",
			"type":"LOOP"
		},
		{
			"context":{
				"appName":"variable_by_unifyapps",
				"resourceVersion":68,
				"resourceName":"variable_by_unifyapps_add_item_to_list",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"lelhq@uEOQH@cpPNH-1@error@l",
			"id":"P8e4j",
			"index":0,
			"inputs":{
				"itemToAdd":"{{ lelhq.outputs.item }}",
				"insertLocation":"END",
				"listName":"{{ rvMsg.outputs.items[0] }}"
			},
			"skip":false,
			"subTitle":"Variable by UnifyApps",
			"title":"Add item to list",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"callables",
				"resourceVersion":48,
				"resourceName":"callables_return_to_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"cpPNH-1",
			"id":"YpdHq",
			"index":0,
			"inputs":{
				"result":{
					"response":"{{ 2UtlP.outputs.answer }}",
					"reference":{
						"source":"{{ rvMsg.outputs.items }}",
						"ua:type":"mappedArray",
						"items":"{{ rvMsg.outputs.items[0] }}"
					}
				}
			},
			"skip":false,
			"subTitle":"Callable",
			"title":"Respond to automation",
			"type":"STOP"
		}
	],
	"ownerUserId":295,
	"runtimeConnectionAppNames":[
		"openai"
	],
	"schemaReferences":[
		
	],
	"settings":{
		"enableNodeLevelLogging":true,
		"enableRunLogging":true,
		"enableVariableLogging":true,
		"route":{
			"default":false,
			"headerValueTierMap":{},
			"tierName":"global"
		}
	},
	"standard":true,
	"tags":[
		"AI Agent"
	],
	"version":148
}